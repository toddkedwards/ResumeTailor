<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResumeForge - AI-Powered Resume Optimization</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PDF.js for PDF parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <!-- mammoth.js for DOCX parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- docx library for DOCX export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.5.0/docx.min.js"></script>
    
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 0 rgba(0, 0, 0, 0.05); }
            50% { box-shadow: 0 0 0 rgba(0, 0, 0, 0.08); }
        }
        @keyframes dotPulse {
            0%, 20% { opacity: 0.3; }
            50% { opacity: 1; }
            80%, 100% { opacity: 0.3; }
        }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
        .animate-slideIn { animation: slideIn 0.5s ease-out; }
        .animate-dot-1 { animation: dotPulse 1.4s infinite; animation-delay: 0s; }
        .animate-dot-2 { animation: dotPulse 1.4s infinite; animation-delay: 0.2s; }
        .animate-dot-3 { animation: dotPulse 1.4s infinite; animation-delay: 0.4s; }
        .glass {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .glass-dark {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
        }
        .gradient-bg {
            background: #ffffff;
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            left: 20px;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }
        @media (min-width: 640px) {
            .toast {
                left: auto;
                right: 20px;
                max-width: 400px;
            }
        }
        .card-hover {
            transition: all 0.2s ease;
        }
        .card-hover:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .touch-manipulation {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        @media (max-width: 640px) {
            .card-hover:hover {
                transform: none;
            }
        }
    </style>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Firebase SDK v10 -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, serverTimestamp, collection, addDoc, getDocs, deleteDoc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getFunctions, httpsCallable } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js';
        
        // Make Firebase modules available globally
        window.firebaseModules = {
            initializeApp,
            getAuth,
            signInAnonymously,
            onAuthStateChanged,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            getFirestore,
            doc,
            getDoc,
            setDoc,
            updateDoc,
            onSnapshot,
            serverTimestamp,
            collection,
            addDoc,
            getDocs,
            deleteDoc,
            query,
            orderBy,
            getFunctions,
            httpsCallable
        };
    </script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/javascript">
        const { useState, useEffect, useRef } = React;
        
        // These will be set after Firebase modules load
        let initializeApp, getAuth, signInAnonymously, onAuthStateChanged, createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, signOut, getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, 
            serverTimestamp, collection, addDoc, getDocs, deleteDoc, query, orderBy, getFunctions, httpsCallable;

        // Configuration - REPLACE WITH YOUR VALUES
        const APP_ID = 'resume-tailor-v1';
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyALXDoW17ultZ3rlSNr9oL4GE6DLCQa3tI",
            authDomain: "resume-tailor-f4f7c.firebaseapp.com",
            projectId: "resume-tailor-f4f7c",
            storageBucket: "resume-tailor-f4f7c.firebasestorage.app",
            messagingSenderId: "697064626570",
            appId: "1:697064626570:web:b9c65f441c8561bab51073"
        };

        // Constants
        const CREDIT_COST = 1;
        const PURCHASE_BUNDLE = 5;

        // Initialize Firebase (will be set after modules load)
        let app, auth, db, functions;

        function App() {
            const [userId, setUserId] = useState(null);
            const [userEmail, setUserEmail] = useState(null);
            const [credits, setCredits] = useState(0);
            const [jobDescription, setJobDescription] = useState('');
            const [resumeSection, setResumeSection] = useState('');
            const [tailoredText, setTailoredText] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [error, setError] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [toast, setToast] = useState(null);
            const [uploadMode, setUploadMode] = useState(false);
            const [uploadedFileName, setUploadedFileName] = useState('');
            const [showAuthModal, setShowAuthModal] = useState(false);
            const [authMode, setAuthMode] = useState('signin'); // 'signin' or 'signup'
            const [authEmail, setAuthEmail] = useState('');
            const [authPassword, setAuthPassword] = useState('');
            const [authLoading, setAuthLoading] = useState(false);
            const [savedResumes, setSavedResumes] = useState([]);
            const [showSavedResumes, setShowSavedResumes] = useState(false);
            const [showLandingPage, setShowLandingPage] = useState(true);
            const [analytics, setAnalytics] = useState(null);
            const [editingResumeId, setEditingResumeId] = useState(null);
            const [editingResumeName, setEditingResumeName] = useState('');
            const [searchQuery, setSearchQuery] = useState('');
            const [showDeleteConfirm, setShowDeleteConfirm] = useState(null);
            const [draftAutoSaved, setDraftAutoSaved] = useState(false);
            const [improvementTips, setImprovementTips] = useState(null);
            const [showStats, setShowStats] = useState(false);
            const [userStats, setUserStats] = useState(null);
            const unsubscribeRef = useRef(null);
            const previousCreditsRef = useRef(0);
            
            // Toast notification function
            const showToast = (message, type = 'success') => {
                setToast({ message, type });
                setTimeout(() => setToast(null), 4000);
            };

            // Initialize authentication
            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, async (user) => {
                    if (user && user.email) {
                        // User is signed in with email/password
                        setUserId(user.uid);
                        setUserEmail(user.email);
                        setIsLoading(false);
                        setShowAuthModal(false);
                        setShowLandingPage(false); // Hide landing page when signed in
                    } else {
                        // No user signed in - show landing page
                        setUserId(null);
                        setUserEmail(null);
                        setIsLoading(false);
                        setShowAuthModal(false);
                        setShowLandingPage(true); // Show landing page
                    }
                });

                return () => unsubscribe();
            }, []);

            // Handle sign up
            const handleSignUp = async () => {
                if (!authEmail || !authPassword) {
                    setError('Please enter email and password');
                    return;
                }
                if (authPassword.length < 6) {
                    setError('Password must be at least 6 characters');
                    return;
                }

                setAuthLoading(true);
                setError(null);

                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, authEmail, authPassword);
                    showToast('Account created successfully!', 'success');
                    setAuthEmail('');
                    setAuthPassword('');
                } catch (error) {
                    console.error('Sign up error:', error);
                    setError(error.message || 'Failed to create account. Please try again.');
                } finally {
                    setAuthLoading(false);
                }
            };

            // Handle sign in
            const handleSignIn = async () => {
                if (!authEmail || !authPassword) {
                    setError('Please enter email and password');
                    return;
                }

                setAuthLoading(true);
                setError(null);

                try {
                    await signInWithEmailAndPassword(auth, authEmail, authPassword);
                    showToast('Signed in successfully!', 'success');
                    setAuthEmail('');
                    setAuthPassword('');
                } catch (error) {
                    console.error('Sign in error:', error);
                    setError(error.message || 'Failed to sign in. Please check your credentials.');
                } finally {
                    setAuthLoading(false);
                }
            };

            // Handle sign out
            const handleSignOut = async () => {
                try {
                    await signOut(auth);
                    showToast('Signed out successfully', 'success');
                    setSavedResumes([]);
                    setTailoredText('');
                    setJobDescription('');
                    setResumeSection('');
                } catch (error) {
                    console.error('Sign out error:', error);
                    setError('Failed to sign out');
                }
            };

            // Set up real-time credit balance listener
            useEffect(() => {
                if (!userId) return;

                const creditsPath = `artifacts/${APP_ID}/users/${userId}/profile/data`;
                const creditsDocRef = doc(db, creditsPath);

                unsubscribeRef.current = onSnapshot(
                    creditsDocRef,
                    async (snapshot) => {
                        if (snapshot.exists()) {
                            const data = snapshot.data();
                            const newCredits = data.credits_balance || 0;
                            const previousCredits = previousCreditsRef.current;
                            
                            // If credits increased, update stats (likely from purchase)
                            if (newCredits > previousCredits && previousCredits >= 0 && userId) {
                                const creditsAdded = newCredits - previousCredits;
                                try {
                                    const statsPath = `artifacts/${APP_ID}/users/${userId}/stats`;
                                    const statsRef = doc(db, statsPath);
                                    const statsDoc = await getDoc(statsRef);
                                    const currentPurchased = statsDoc.exists() ? (statsDoc.data().totalCreditsPurchased || 0) : 0;
                                    
                                    await setDoc(statsRef, {
                                        totalCreditsPurchased: currentPurchased + creditsAdded,
                                        updatedAt: serverTimestamp()
                                    }, { merge: true });
                                    
                                    if (userStats) {
                                        setUserStats(prev => prev ? {
                                            ...prev,
                                            totalCreditsPurchased: (prev.totalCreditsPurchased || 0) + creditsAdded
                                        } : null);
                                    }
                                } catch (error) {
                                    console.error('Error updating purchase stats:', error);
                                }
                            }
                            
                            previousCreditsRef.current = newCredits;
                            setCredits(newCredits);
                        } else {
                            setCredits(0);
                            previousCreditsRef.current = 0;
                            try {
                                await setDoc(creditsDocRef, {
                                    credits_balance: 0,
                                    created_at: serverTimestamp(),
                                    updated_at: serverTimestamp()
                                }, { merge: true });
                            } catch (error) {
                                console.error('Error initializing credits document:', error);
                            }
                        }
                    },
                    (error) => {
                        console.error('Error listening to credits:', error);
                        setError('Failed to load credit balance.');
                    }
                );

                return () => {
                    if (unsubscribeRef.current) {
                        unsubscribeRef.current();
                    }
                };
            }, [userId]);

            // Decrement credits function
            const decrementCredits = async () => {
                if (!userId) return false;

                const creditsPath = `artifacts/${APP_ID}/users/${userId}/profile/data`;
                const creditsDocRef = doc(db, creditsPath);

                try {
                    const docSnap = await getDoc(creditsDocRef);
                    const currentCredits = docSnap.exists() ? (docSnap.data().credits_balance || 0) : 0;

                    if (currentCredits < CREDIT_COST) {
                        return false;
                    }

                    await updateDoc(creditsDocRef, {
                        credits_balance: currentCredits - CREDIT_COST,
                        updated_at: serverTimestamp()
                    });

                    return true;
                } catch (error) {
                    console.error('Error decrementing credits:', error);
                    return false;
                }
            };

            // Handle Stripe checkout for credit purchase
            const handleCreditPurchase = async () => {
                if (!userId) {
                    setError('Please wait for authentication to complete.');
                    return;
                }

                try {
                    const createCheckoutSession = httpsCallable(functions, 'createCheckoutSession');
                    const currentUrl = window.location.origin + window.location.pathname;
                    
                    const result = await createCheckoutSession({
                        currentUrl: currentUrl
                    });

                    if (result.data && result.data.url) {
                        // Redirect to Stripe Checkout
                        window.location.href = result.data.url;
                    } else {
                        throw new Error('No checkout URL returned');
                    }
                } catch (error) {
                    console.error('Error creating checkout session:', error);
                    setError(error.message || 'Failed to create checkout session. Please try again.');
                    showToast('Failed to start checkout. Please try again.', 'error');
                }
            };

            // Handle Stripe redirect after payment
            useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const sessionId = urlParams.get('session_id');
                const success = urlParams.get('success');
                const canceled = urlParams.get('canceled');

                if (success && sessionId) {
                    showToast('Payment successful! Credits will be added to your account shortly.', 'success');
                    // Clean up URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                    // Refresh credits after a short delay to allow webhook to process
                    setTimeout(() => {
                        if (userId) {
                            const creditsPath = `artifacts/${APP_ID}/users/${userId}/profile/data`;
                            const creditsDocRef = doc(db, creditsPath);
                            getDoc(creditsDocRef).then((docSnap) => {
                                if (docSnap.exists()) {
                                    setCredits(docSnap.data().credits_balance || 0);
                                }
                            });
                        }
                    }, 2000);
                } else if (canceled) {
                    showToast('Payment canceled', 'info');
                    // Clean up URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            }, [userId]);

            // Input validation
            const validateInputs = () => {
                const jd = jobDescription.trim();
                const rs = resumeSection.trim();

                if (!jd) {
                    setError('Please enter a Job Description.');
                    return false;
                }
                if (jd.length < 50) {
                    setError('Job Description must be at least 50 characters. Please provide more details.');
                    return false;
                }
                if (jd.length > 10000) {
                    setError('Job Description is too long (max 10,000 characters).');
                    return false;
                }

                if (!rs) {
                    setError('Please enter your Current Resume Section.');
                    return false;
                }
                if (rs.length < 20) {
                    setError('Resume Section must be at least 20 characters. Please provide more content.');
                    return false;
                }
                if (rs.length > 5000) {
                    setError('Resume Section is too long (max 5,000 characters).');
                    return false;
                }

                return true;
            };

            // Keyword matching analytics
            const analyzeKeywords = (jobDesc, originalResume, tailoredResume) => {
                if (!jobDesc || !originalResume || !tailoredResume) return null;

                // Extract keywords from job description (simple approach)
                const jobWords = jobDesc.toLowerCase()
                    .replace(/[^\w\s]/g, ' ')
                    .split(/\s+/)
                    .filter(w => w.length > 3)
                    .filter((w, i, arr) => arr.indexOf(w) === i); // unique

                // Count matches in original and tailored
                const originalWords = originalResume.toLowerCase()
                    .replace(/[^\w\s]/g, ' ')
                    .split(/\s+/)
                    .filter(w => w.length > 3);

                const tailoredWords = tailoredResume.toLowerCase()
                    .replace(/[^\w\s]/g, ' ')
                    .split(/\s+/)
                    .filter(w => w.length > 3);

                const originalMatches = jobWords.filter(jw => 
                    originalWords.some(ow => ow.includes(jw) || jw.includes(ow))
                ).length;

                const tailoredMatches = jobWords.filter(jw => 
                    tailoredWords.some(tw => tw.includes(jw) || jw.includes(tw))
                ).length;

                const totalKeywords = jobWords.length;
                const originalScore = totalKeywords > 0 ? Math.round((originalMatches / totalKeywords) * 100) : 0;
                const tailoredScore = totalKeywords > 0 ? Math.round((tailoredMatches / totalKeywords) * 100) : 0;
                const improvement = tailoredScore - originalScore;

                const missingKeywords = jobWords.filter(jw => 
                    !tailoredWords.some(tw => tw.includes(jw) || jw.includes(tw))
                ).slice(0, 10); // Top 10 missing

                return {
                    originalScore,
                    tailoredScore,
                    improvement,
                    originalMatches,
                    tailoredMatches,
                    totalKeywords,
                    missingKeywords
                };
            };

            // Generate tailored resume with retry mechanism
            const generateTailoredResume = async (retryCount = 0) => {
                // Validate inputs
                if (!validateInputs()) {
                    return;
                }

                if (credits < CREDIT_COST) {
                    setError(`Insufficient credits. You need ${CREDIT_COST} credit to generate. Please purchase credits.`);
                    return;
                }

                setIsGenerating(true);
                setError(null);
                setTailoredText('');
                setAnalytics(null);
                setImprovementTips(null);

                try {
                    const creditDeducted = await decrementCredits();
                    if (!creditDeducted) {
                        setError('Failed to deduct credits. Please try again.');
                        setIsGenerating(false);
                        return;
                    }

                    const tailorResume = httpsCallable(functions, 'tailorResume');
                    const result = await tailorResume({
                        jobDescription: jobDescription.trim(),
                        resumeSection: resumeSection.trim()
                    });

                    if (result.data && result.data.tailoredText) {
                        const tailored = result.data.tailoredText;
                        setTailoredText(tailored);
                        
                        // Calculate analytics
                        const analytics = analyzeKeywords(
                            jobDescription.trim(),
                            resumeSection.trim(),
                            tailored
                        );
                        setAnalytics(analytics);
                        
                        // Update statistics
                        await updateUserStats(analytics.improvement || 0);
                        
                        // Generate improvement tips
                        try {
                            const generateTips = httpsCallable(functions, 'generateImprovementTips');
                            const tipsResult = await generateTips({
                                jobDescription: jobDescription.trim(),
                                originalResume: resumeSection.trim(),
                                tailoredResume: tailored
                            });
                            if (tipsResult.data && tipsResult.data.tips) {
                                setImprovementTips(tipsResult.data.tips);
                            }
                        } catch (tipsError) {
                            console.error('Error generating tips:', tipsError);
                            // Don't fail the whole operation if tips fail
                        }
                        
                        showToast('Resume tailored successfully!', 'success');
                    } else {
                        throw new Error('No tailored text returned from API');
                    }
                } catch (error) {
                    console.error('Error generating tailored resume:', error);
                    
                    // Refund credit if generation failed
                    if (userId) {
                        const creditsPath = `artifacts/${APP_ID}/users/${userId}/profile/data`;
                        const creditsDocRef = doc(db, creditsPath);
                        try {
                            const docSnap = await getDoc(creditsDocRef);
                            const currentCredits = docSnap.exists() ? (docSnap.data().credits_balance || 0) : 0;
                            await updateDoc(creditsDocRef, {
                                credits_balance: currentCredits + CREDIT_COST,
                                updated_at: serverTimestamp()
                            });
                            showToast('Credit refunded due to error', 'info');
                        } catch (refundError) {
                            console.error('Error refunding credit:', refundError);
                        }
                    }

                    // Better error messages
                    let errorMessage = 'Failed to generate tailored resume. ';
                    if (error.message) {
                        if (error.message.includes('network') || error.message.includes('fetch')) {
                            errorMessage += 'Network error. Please check your connection and try again.';
                        } else if (error.message.includes('timeout')) {
                            errorMessage += 'Request timed out. Please try again.';
                        } else if (error.message.includes('API key')) {
                            errorMessage += 'API configuration error. Please contact support.';
                        } else if (error.message.includes('quota') || error.message.includes('limit')) {
                            errorMessage += 'Service temporarily unavailable. Please try again later.';
                        } else {
                            errorMessage += error.message;
                        }
                    } else {
                        errorMessage += 'Please try again.';
                    }

                    setError(errorMessage);

                    // Retry mechanism (max 2 retries)
                    if (retryCount < 2 && (error.message?.includes('network') || error.message?.includes('timeout'))) {
                        setTimeout(() => {
                            showToast(`Retrying... (${retryCount + 1}/2)`, 'info');
                            generateTailoredResume(retryCount + 1);
                        }, 2000);
                        return;
                    }
                } finally {
                    setIsGenerating(false);
                }
            };

            // Copy to clipboard
            const copyToClipboard = () => {
                if (!tailoredText) return;

                navigator.clipboard.writeText(tailoredText).then(() => {
                    showToast('Copied to clipboard!', 'success');
                }).catch((error) => {
                    console.error('Failed to copy:', error);
                    showToast('Failed to copy to clipboard.', 'error');
                });
            };

            // Export to PDF
            const exportToPDF = () => {
                if (!tailoredText) {
                    showToast('No content to export', 'error');
                    return;
                }

                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // Set font and margins
                    const pageWidth = doc.internal.pageSize.getWidth();
                    const pageHeight = doc.internal.pageSize.getHeight();
                    const margin = 20;
                    const maxWidth = pageWidth - (margin * 2);
                    
                    // Split text into lines that fit the page
                    const lines = doc.splitTextToSize(tailoredText, maxWidth);
                    let y = margin;
                    const lineHeight = 7;
                    
                    // Add title
                    doc.setFontSize(16);
                    doc.setFont(undefined, 'bold');
                    doc.text('Tailored Resume Section', margin, y);
                    y += lineHeight * 2;
                    
                    // Add content
                    doc.setFontSize(11);
                    doc.setFont(undefined, 'normal');
                    
                    lines.forEach((line) => {
                        if (y + lineHeight > pageHeight - margin) {
                            doc.addPage();
                            y = margin;
                        }
                        doc.text(line, margin, y);
                        y += lineHeight;
                    });
                    
                    // Save the PDF
                    const fileName = `ResumeForge_Tailored_${new Date().toISOString().split('T')[0]}.pdf`;
                    doc.save(fileName);
                    showToast('PDF exported successfully!', 'success');
                } catch (error) {
                    console.error('Error exporting to PDF:', error);
                    showToast('Failed to export PDF. Please try again.', 'error');
                }
            };

            // Export to DOCX
            const exportToDOCX = async () => {
                if (!tailoredText) {
                    showToast('No content to export', 'error');
                    return;
                }

                try {
                    // Create a Word-compatible HTML document
                    // This format is recognized by Microsoft Word and will open properly
                    const htmlContent = `<!DOCTYPE html>
<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
<head>
    <meta charset="UTF-8">
    <meta name="ProgId" content="Word.Document">
    <meta name="Generator" content="ResumeForge">
    <meta name="Originator" content="ResumeForge">
    <title>Tailored Resume Section</title>
    <!--[if gte mso 9]>
    <xml>
        <w:WordDocument>
            <w:View>Print</w:View>
            <w:Zoom>100</w:Zoom>
            <w:DoNotOptimizeForBrowser/>
        </w:WordDocument>
    </xml>
    <![endif]-->
    <style>
        @page {
            size: 8.5in 11in;
            margin: 1in;
        }
        body {
            font-family: 'Calibri', 'Arial', sans-serif;
            font-size: 11pt;
            line-height: 1.5;
            color: #000000;
        }
        h1 {
            font-size: 16pt;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 12pt;
        }
        p {
            margin: 6pt 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Tailored Resume Section</h1>
    <p>${tailoredText.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br>')}</p>
</body>
</html>`;
                    
                    // Create blob with Word-compatible MIME type
                    const blob = new Blob(['\ufeff', htmlContent], { 
                        type: 'application/msword' 
                    });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `ResumeForge_Tailored_${new Date().toISOString().split('T')[0]}.doc`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    showToast('Document exported successfully!', 'success');
                } catch (error) {
                    console.error('Error exporting to DOCX:', error);
                    showToast('Failed to export document. Please try again.', 'error');
                }
            };

            // Save tailored resume
            const saveTailoredResume = async () => {
                if (!userId || !tailoredText || !jobDescription || !resumeSection) {
                    showToast('Nothing to save. Please generate a tailored resume first.', 'error');
                    return;
                }

                try {
                    const savedResumesPath = `artifacts/${APP_ID}/users/${userId}/saved_resumes`;
                    const savedResumesRef = collection(db, savedResumesPath);
                    
                    // Generate a default name from job description
                    const defaultName = jobDescription.trim().substring(0, 50) + (jobDescription.length > 50 ? '...' : '');
                    
                    await addDoc(savedResumesRef, {
                        name: defaultName,
                        jobDescription: jobDescription.trim(),
                        originalSection: resumeSection.trim(),
                        tailoredSection: tailoredText.trim(),
                        createdAt: serverTimestamp(),
                        updatedAt: serverTimestamp()
                    });

                    showToast('Resume saved successfully!', 'success');
                    loadSavedResumes(); // Refresh the list
                } catch (error) {
                    console.error('Error saving resume:', error);
                    showToast('Failed to save resume. Please try again.', 'error');
                }
            };

            // Load saved resumes
            const loadSavedResumes = async () => {
                if (!userId) return;

                try {
                    const savedResumesPath = `artifacts/${APP_ID}/users/${userId}/saved_resumes`;
                    const savedResumesRef = collection(db, savedResumesPath);
                    const q = query(savedResumesRef, orderBy('createdAt', 'desc'));
                    const querySnapshot = await getDocs(q);
                    
                    const resumes = [];
                    querySnapshot.forEach((docSnap) => {
                        resumes.push({
                            id: docSnap.id,
                            ...docSnap.data()
                        });
                    });
                    
                    setSavedResumes(resumes);
                } catch (error) {
                    console.error('Error loading saved resumes:', error);
                }
            };

            // Load a saved resume
            const loadSavedResume = (savedResume) => {
                setJobDescription(savedResume.jobDescription || '');
                setResumeSection(savedResume.originalSection || '');
                setTailoredText(savedResume.tailoredSection || '');
                setShowSavedResumes(false);
                showToast('Resume loaded!', 'success');
            };

            // Delete a saved resume
            const deleteSavedResume = async (resumeId) => {
                if (!userId) return;
                
                try {
                    const resumeDocRef = doc(db, `artifacts/${APP_ID}/users/${userId}/saved_resumes/${resumeId}`);
                    await deleteDoc(resumeDocRef);
                    showToast('Resume deleted successfully', 'success');
                    setShowDeleteConfirm(null);
                    loadSavedResumes(); // Refresh the list
                } catch (error) {
                    console.error('Error deleting resume:', error);
                    showToast('Failed to delete resume', 'error');
                }
            };

            // Update saved resume name
            const updateResumeName = async (resumeId, newName) => {
                if (!userId || !newName.trim()) return;

                try {
                    const resumeDocRef = doc(db, `artifacts/${APP_ID}/users/${userId}/saved_resumes/${resumeId}`);
                    await updateDoc(resumeDocRef, {
                        name: newName.trim(),
                        updatedAt: serverTimestamp()
                    });
                    showToast('Resume renamed successfully', 'success');
                    setEditingResumeId(null);
                    setEditingResumeName('');
                    loadSavedResumes();
                } catch (error) {
                    console.error('Error updating resume name:', error);
                    showToast('Failed to rename resume', 'error');
                }
            };

            // Filter saved resumes by search query
            const filteredSavedResumes = savedResumes.filter(resume => {
                if (!searchQuery.trim()) return true;
                const query = searchQuery.toLowerCase();
                return (
                    (resume.name && resume.name.toLowerCase().includes(query)) ||
                    (resume.jobDescription && resume.jobDescription.toLowerCase().includes(query)) ||
                    (resume.originalSection && resume.originalSection.toLowerCase().includes(query)) ||
                    (resume.tailoredSection && resume.tailoredSection.toLowerCase().includes(query))
                );
            });

            // Load saved resumes when user signs in
            useEffect(() => {
                if (userId) {
                    loadSavedResumes();
                    loadUserStats();
                }
            }, [userId]);

            // Update user statistics
            const updateUserStats = async (improvement) => {
                if (!userId) return;

                try {
                    const statsPath = `artifacts/${APP_ID}/users/${userId}/stats`;
                    const statsRef = doc(db, statsPath);
                    const statsDoc = await getDoc(statsRef);

                    const today = new Date().toISOString().split('T')[0];
                    const currentData = statsDoc.exists() ? statsDoc.data() : {
                        totalGenerations: 0,
                        totalCreditsPurchased: 0,
                        totalCreditsUsed: 0,
                        savedResumesCount: savedResumes.length,
                        totalImprovement: 0,
                        improvementCount: 0,
                        generationsByDate: {},
                        createdAt: serverTimestamp(),
                        lastGenerationDate: null
                    };

                    const newData = {
                        totalGenerations: (currentData.totalGenerations || 0) + 1,
                        totalCreditsUsed: (currentData.totalCreditsUsed || 0) + 1,
                        totalImprovement: (currentData.totalImprovement || 0) + (improvement || 0),
                        improvementCount: (currentData.improvementCount || 0) + (improvement > 0 ? 1 : 0),
                        generationsByDate: {
                            ...(currentData.generationsByDate || {}),
                            [today]: ((currentData.generationsByDate || {})[today] || 0) + 1
                        },
                        lastGenerationDate: serverTimestamp(),
                        updatedAt: serverTimestamp()
                    };

                    await setDoc(statsRef, newData, { merge: true });
                    setUserStats(newData);
                } catch (error) {
                    console.error('Error updating stats:', error);
                }
            };

            // Load user statistics
            const loadUserStats = async () => {
                if (!userId) return;

                try {
                    const statsPath = `artifacts/${APP_ID}/users/${userId}/stats`;
                    const statsRef = doc(db, statsPath);
                    const statsDoc = await getDoc(statsRef);

                    if (statsDoc.exists()) {
                        const data = statsDoc.data();
                        // Also get saved resumes count
                        const savedResumesPath = `artifacts/${APP_ID}/users/${userId}/saved_resumes`;
                        const savedResumesRef = collection(db, savedResumesPath);
                        const savedResumesSnapshot = await getDocs(savedResumesRef);
                        
                        const stats = {
                            ...data,
                            savedResumesCount: savedResumesSnapshot.size,
                            averageImprovement: data.improvementCount > 0 
                                ? Math.round(data.totalImprovement / data.improvementCount) 
                                : 0
                        };
                        setUserStats(stats);
                    } else {
                        // Initialize stats
                        const savedResumesPath = `artifacts/${APP_ID}/users/${userId}/saved_resumes`;
                        const savedResumesRef = collection(db, savedResumesPath);
                        const savedResumesSnapshot = await getDocs(savedResumesRef);
                        
                        const initialStats = {
                            totalGenerations: 0,
                            totalCreditsPurchased: 0,
                            totalCreditsUsed: 0,
                            savedResumesCount: savedResumesSnapshot.size,
                            averageImprovement: 0,
                            generationsByDate: {}
                        };
                        setUserStats(initialStats);
                    }
                } catch (error) {
                    console.error('Error loading stats:', error);
                }
            };

            // Update stats when saved resumes change
            useEffect(() => {
                if (userId && userStats) {
                    const statsPath = `artifacts/${APP_ID}/users/${userId}/stats`;
                    const statsRef = doc(db, statsPath);
                    setDoc(statsRef, {
                        savedResumesCount: savedResumes.length,
                        updatedAt: serverTimestamp()
                    }, { merge: true }).then(() => {
                        setUserStats(prev => prev ? { ...prev, savedResumesCount: savedResumes.length } : null);
                    });
                }
            }, [savedResumes.length, userId]);

            // Keyboard shortcuts
            useEffect(() => {
                const handleKeyDown = (e) => {
                    // Ctrl+Enter or Cmd+Enter to generate
                    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                        if (!isGenerating && credits >= CREDIT_COST && jobDescription.trim() && resumeSection.trim()) {
                            e.preventDefault();
                            generateTailoredResume();
                        }
                    }
                    // Escape to close modals
                    if (e.key === 'Escape') {
                        if (showSavedResumes) {
                            setShowSavedResumes(false);
                        }
                        if (showAuthModal) {
                            setShowAuthModal(false);
                        }
                        if (showDeleteConfirm) {
                            setShowDeleteConfirm(null);
                        }
                        if (editingResumeId) {
                            setEditingResumeId(null);
                            setEditingResumeName('');
                        }
                    }
                };

                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [isGenerating, credits, jobDescription, resumeSection, showSavedResumes, showAuthModal, showDeleteConfirm, editingResumeId]);

            // Auto-save drafts to localStorage
            useEffect(() => {
                if (userId && (jobDescription || resumeSection)) {
                    const draft = {
                        jobDescription,
                        resumeSection,
                        timestamp: Date.now()
                    };
                    localStorage.setItem(`resumeforge_draft_${userId}`, JSON.stringify(draft));
                    setDraftAutoSaved(true);
                    setTimeout(() => setDraftAutoSaved(false), 2000);
                }
            }, [jobDescription, resumeSection, userId]);

            // Load draft on mount
            useEffect(() => {
                if (userId) {
                    const savedDraft = localStorage.getItem(`resumeforge_draft_${userId}`);
                    if (savedDraft) {
                        try {
                            const draft = JSON.parse(savedDraft);
                            // Only load if draft is less than 24 hours old
                            if (Date.now() - draft.timestamp < 24 * 60 * 60 * 1000) {
                                if (draft.jobDescription && !jobDescription) {
                                    setJobDescription(draft.jobDescription);
                                }
                                if (draft.resumeSection && !resumeSection) {
                                    setResumeSection(draft.resumeSection);
                                }
                            }
                        } catch (e) {
                            console.error('Error loading draft:', e);
                        }
                    }
                }
            }, [userId]);

            // Handle file upload
            const handleFileUpload = async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                // Check file size (10MB limit)
                if (file.size > 10 * 1024 * 1024) {
                    showToast('File size exceeds 10MB limit. Please upload a smaller file.', 'error');
                    return;
                }

                setUploadedFileName(file.name);
                setError(null);
                setIsGenerating(true);

                try {
                    let extractedText = '';

                    if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                        // Plain text file
                        extractedText = await file.text();
                    } else if (file.type === 'application/pdf' || file.name.endsWith('.pdf')) {
                        // PDF parsing using pdf.js
                        const arrayBuffer = await file.arrayBuffer();
                        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                        const numPages = pdf.numPages;
                        
                        for (let i = 1; i <= numPages; i++) {
                            const page = await pdf.getPage(i);
                            const textContent = await page.getTextContent();
                            const pageText = textContent.items.map(item => item.str).join(' ');
                            extractedText += pageText + '\n\n';
                        }
                    } else if (file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' || file.name.endsWith('.docx')) {
                        // DOCX parsing using mammoth
                        const arrayBuffer = await file.arrayBuffer();
                        const result = await mammoth.extractRawText({ arrayBuffer });
                        extractedText = result.value;
                    } else {
                        showToast('Unsupported file type. Please upload .txt, .pdf, or .docx files.', 'error');
                        setIsGenerating(false);
                        return;
                    }

                    // Set the extracted text to the resume section
                    setResumeSection(extractedText);
                    showToast(`File "${file.name}" loaded successfully!`, 'success');
                } catch (error) {
                    console.error('Error reading file:', error);
                    showToast('Failed to read file. Please try pasting the text instead.', 'error');
                } finally {
                    setIsGenerating(false);
                }
            };
            
            // Character counters
            const jdCharCount = jobDescription.length;
            const resumeCharCount = resumeSection.length;

            if (isLoading) {
                return React.createElement('div', {
                    className: "min-h-screen gradient-bg flex items-center justify-center"
                }, React.createElement('div', { className: "text-center glass rounded-2xl p-12 shadow-2xl" },
                    React.createElement('div', { className: "relative w-16 h-16 mx-auto mb-6" },
                        React.createElement('div', { className: "absolute inset-0 border-4 border-gray-200 rounded-full" }),
                        React.createElement('div', { className: "absolute inset-0 border-4 border-gray-900 rounded-full border-t-transparent animate-spin" })
                    ),
                    React.createElement('p', { className: "text-gray-700 font-semibold text-lg" }, "Initializing..."),
                    React.createElement('p', { className: "text-gray-500 text-sm mt-2" }, "Setting up your workspace")
                ));
            }

            // Landing Page (shown when not signed in)
            if (!userId && showLandingPage) {
                return React.createElement('div', { className: "min-h-screen gradient-bg" },
                    // Hero Section
                    React.createElement('div', { className: "container mx-auto px-4 py-20" },
                        React.createElement('div', { className: "text-center mb-16 animate-fadeIn" },
                            React.createElement('h1', { className: "text-6xl md:text-7xl font-extrabold text-black mb-6" }, "ResumeForge"),
                            React.createElement('p', { className: "text-2xl md:text-3xl text-gray-700 font-medium mb-4" }, "Optimize Your Resume for ATS Systems"),
                            React.createElement('p', { className: "text-lg text-gray-600 max-w-2xl mx-auto mb-8" }, "AI-powered resume tailoring that matches job descriptions perfectly. Get past ATS filters and land more interviews."),
                            React.createElement('button', {
                                onClick: () => {
                                    setShowAuthModal(true);
                                    setAuthMode('signup');
                                },
                                className: "px-8 py-4 bg-gray-900 text-white rounded-xl font-bold text-lg hover:bg-gray-800 transition-all shadow-sm hover:shadow-md"
                            }, "Get Started Free")
                        ),
                        // Features Section
                        React.createElement('div', { className: "max-w-6xl mx-auto mb-20" },
                            React.createElement('h2', { className: "text-3xl font-bold text-center text-gray-800 mb-12" }, "Why ResumeForge?"),
                            React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-8" },
                                React.createElement('div', { className: "glass rounded-2xl p-6 text-center card-hover" },
                                    React.createElement('div', { className: "text-5xl mb-4" }, ""),
                                    React.createElement('h3', { className: "text-xl font-bold text-gray-800 mb-2" }, "ATS Optimization"),
                                    React.createElement('p', { className: "text-gray-600" }, "Match keywords from job descriptions to pass ATS filters automatically")
                                ),
                                React.createElement('div', { className: "glass rounded-2xl p-6 text-center card-hover" },
                                    React.createElement('div', { className: "text-5xl mb-4" }, ""),
                                    React.createElement('h3', { className: "text-xl font-bold text-gray-800 mb-2" }, "Lightning Fast"),
                                    React.createElement('p', { className: "text-gray-600" }, "Get tailored resume sections in seconds with AI-powered processing")
                                ),
                                React.createElement('div', { className: "glass rounded-2xl p-6 text-center card-hover" },
                                    React.createElement('div', { className: "text-5xl mb-4" }, ""),
                                    React.createElement('h3', { className: "text-xl font-bold text-gray-800 mb-2" }, "Save & Manage"),
                                    React.createElement('p', { className: "text-gray-600" }, "Save multiple tailored resumes and access them anytime")
                                ),
                                React.createElement('div', { className: "glass rounded-2xl p-6 text-center card-hover" },
                                    React.createElement('div', { className: "text-5xl mb-4" }, ""),
                                    React.createElement('h3', { className: "text-xl font-bold text-gray-800 mb-2" }, "File Upload"),
                                    React.createElement('p', { className: "text-gray-600" }, "Upload PDF, DOCX, or TXT files - we'll extract the text for you")
                                ),
                                React.createElement('div', { className: "glass rounded-2xl p-6 text-center card-hover" },
                                    React.createElement('div', { className: "text-5xl mb-4" }, ""),
                                    React.createElement('h3', { className: "text-xl font-bold text-gray-800 mb-2" }, "Secure & Private"),
                                    React.createElement('p', { className: "text-gray-600" }, "Your data is encrypted and stored securely in your account")
                                ),
                                React.createElement('div', { className: "glass rounded-2xl p-6 text-center card-hover" },
                                    React.createElement('div', { className: "text-5xl mb-4" }, ""),
                                    React.createElement('h3', { className: "text-xl font-bold text-gray-800 mb-2" }, "Affordable"),
                                    React.createElement('p', { className: "text-gray-600" }, "Pay only for what you use - $2 for 5 generations")
                                )
                            )
                        ),
                        // How It Works Section
                        React.createElement('div', { className: "max-w-4xl mx-auto mb-20" },
                            React.createElement('h2', { className: "text-3xl font-bold text-center text-gray-800 mb-12" }, "How It Works"),
                            React.createElement('div', { className: "space-y-8" },
                                React.createElement('div', { className: "flex items-start gap-6 glass rounded-2xl p-6 card-hover" },
                                    React.createElement('div', { className: "text-4xl font-bold text-gray-900 flex-shrink-0" }, "1"),
                                    React.createElement('div', null,
                                        React.createElement('h3', { className: "text-xl font-bold text-gray-800 mb-2" }, "Paste Job Description"),
                                        React.createElement('p', { className: "text-gray-600" }, "Copy and paste the job description you're applying for")
                                    )
                                ),
                                React.createElement('div', { className: "flex items-start gap-6 glass rounded-2xl p-6 card-hover" },
                                    React.createElement('div', { className: "text-4xl font-bold text-gray-900 flex-shrink-0" }, "2"),
                                    React.createElement('div', null,
                                        React.createElement('h3', { className: "text-xl font-bold text-gray-800 mb-2" }, "Upload or Paste Resume"),
                                        React.createElement('p', { className: "text-gray-600" }, "Upload your resume file (PDF/DOCX/TXT) or paste the section you want to tailor")
                                    )
                                ),
                                React.createElement('div', { className: "flex items-start gap-6 glass rounded-2xl p-6 card-hover" },
                                    React.createElement('div', { className: "text-4xl font-bold text-gray-900 flex-shrink-0" }, "3"),
                                    React.createElement('div', null,
                                        React.createElement('h3', { className: "text-xl font-bold text-gray-800 mb-2" }, "AI Optimizes Keywords"),
                                        React.createElement('p', { className: "text-gray-600" }, "Our AI analyzes the job description and rewrites your resume with matching keywords")
                                    )
                                ),
                                React.createElement('div', { className: "flex items-start gap-6 glass rounded-2xl p-6 card-hover" },
                                    React.createElement('div', { className: "text-4xl font-bold text-gray-900 flex-shrink-0" }, "4"),
                                    React.createElement('div', null,
                                        React.createElement('h3', { className: "text-xl font-bold text-gray-800 mb-2" }, "Copy & Use"),
                                        React.createElement('p', { className: "text-gray-600" }, "Copy your optimized resume section and paste it into your resume. Save it for future reference!")
                                    )
                                )
                            )
                        ),
                        // Pricing Section
                        React.createElement('div', { className: "max-w-4xl mx-auto mb-20" },
                            React.createElement('h2', { className: "text-3xl font-bold text-center text-gray-800 mb-12" }, "Simple, Transparent Pricing"),
                            React.createElement('div', { className: "glass rounded-2xl p-8 text-center card-hover" },
                                React.createElement('h3', { className: "text-2xl font-bold text-gray-800 mb-4" }, "Credit-Based System"),
                                React.createElement('p', { className: "text-gray-600 mb-6" }, "Pay only for what you use. No subscriptions, no hidden fees."),
                                React.createElement('div', { className: "inline-flex items-center gap-4 glass rounded-xl px-8 py-4" },
                                    React.createElement('div', null,
                                        React.createElement('div', { className: "text-3xl font-bold text-gray-900" }, "$2.00"),
                                        React.createElement('div', { className: "text-sm text-gray-600" }, "for 5 credits")
                                    ),
                                    React.createElement('div', { className: "h-12 w-px bg-gray-300" }),
                                    React.createElement('div', null,
                                        React.createElement('div', { className: "text-3xl font-bold text-gray-900" }, "1 Credit"),
                                        React.createElement('div', { className: "text-sm text-gray-600" }, "= 1 Generation")
                                    )
                                )
                            )
                        ),
                        // Final CTA
                        React.createElement('div', { className: "text-center" },
                            React.createElement('h2', { className: "text-3xl font-bold text-gray-800 mb-4" }, "Ready to Optimize Your Resume?"),
                            React.createElement('p', { className: "text-lg text-gray-600 mb-8" }, "Join thousands of job seekers getting more interviews"),
                            React.createElement('button', {
                                onClick: () => {
                                    setShowAuthModal(true);
                                    setAuthMode('signup');
                                },
                                className: "px-8 py-4 bg-gray-900 text-white rounded-xl font-bold text-lg hover:bg-gray-800 transition-all shadow-sm hover:shadow-md"
                            }, "Get Started Free")
                        )
                    ),
                    // Auth Modal (same as before)
                    showAuthModal && React.createElement('div', {
                        className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",
                        onClick: () => setShowAuthModal(false)
                    },
                        React.createElement('div', {
                            className: "glass rounded-2xl p-8 max-w-md w-full shadow-2xl",
                            onClick: (e) => e.stopPropagation()
                        },
                            React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-6 text-center" },
                                authMode === 'signin' ? 'Sign In to ResumeForge' : 'Create Account'
                            ),
                            error && React.createElement('div', {
                                className: "mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm"
                            }, error),
                            React.createElement('div', { className: "space-y-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-semibold text-gray-700 mb-2" }, "Email"),
                                    React.createElement('input', {
                                        type: 'email',
                                        value: authEmail,
                                        onChange: (e) => setAuthEmail(e.target.value),
                                        placeholder: "your@email.com",
                                        className: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-1 focus:ring-gray-900 focus:border-gray-900 transition-all"
                                    })
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-semibold text-gray-700 mb-2" }, "Password"),
                                    React.createElement('input', {
                                        type: 'password',
                                        value: authPassword,
                                        onChange: (e) => setAuthPassword(e.target.value),
                                        placeholder: "",
                                        className: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-1 focus:ring-gray-900 focus:border-gray-900 transition-all"
                                    })
                                ),
                                React.createElement('button', {
                                    onClick: authMode === 'signin' ? handleSignIn : handleSignUp,
                                    disabled: authLoading,
                                    className: `w-full py-3 bg-gray-900 text-white rounded-xl font-semibold hover:bg-gray-800 transition-all ${authLoading ? 'opacity-50 cursor-not-allowed' : ''}`
                                }, authLoading ? 'Loading...' : (authMode === 'signin' ? 'Sign In' : 'Sign Up')),
                                React.createElement('div', { className: "text-center text-sm text-gray-600" },
                                    authMode === 'signin' ? 
                                        React.createElement(React.Fragment, null,
                                            "Don't have an account? ",
                                            React.createElement('button', {
                                                onClick: () => {
                                                    setAuthMode('signup');
                                                    setError(null);
                                                },
                                                className: "text-gray-900 hover:text-gray-700 hover:underline font-semibold"
                                            }, "Sign Up")
                                        ) :
                                        React.createElement(React.Fragment, null,
                                            "Already have an account? ",
                                            React.createElement('button', {
                                                onClick: () => {
                                                    setAuthMode('signin');
                                                    setError(null);
                                                },
                                                className: "text-gray-900 hover:text-gray-700 hover:underline font-semibold"
                                            }, "Sign In")
                                        )
                                )
                            )
                        )
                    )
                );
            }

            return React.createElement('div', { className: "min-h-screen gradient-bg py-8 px-4" },
                React.createElement('div', { className: "max-w-7xl mx-auto" },
                    // Toast Notification
                    toast ? React.createElement('div', {
                        className: `toast glass rounded-lg px-6 py-4 shadow-xl flex items-center gap-3 ${
                            toast.type === 'success' ? 'bg-green-50 border border-green-200' : 
                            toast.type === 'error' ? 'bg-red-50 border border-red-200' : 
                            'bg-blue-50 border border-blue-200'
                        }`
                    },
                        React.createElement('span', { className: "text-2xl" }, 
                            toast.type === 'success' ? '' : toast.type === 'error' ? '' : ''
                        ),
                        React.createElement('span', { 
                            className: toast.type === 'success' ? 'text-green-800 font-medium' : 
                                      toast.type === 'error' ? 'text-red-800 font-medium' : 
                                      'text-blue-800 font-medium'
                        }, toast.message)
                    ) : null,
                    // Header
                    React.createElement('div', { className: "text-center mb-6 sm:mb-10 animate-fadeIn" },
                        React.createElement('h1', { className: "text-3xl sm:text-4xl md:text-5xl font-extrabold text-black mb-2 sm:mb-4" }, "ResumeForge"),
                        React.createElement('p', { className: "text-gray-700 text-sm sm:text-base md:text-lg font-medium mb-4 sm:mb-6 px-4" }, "Optimize your resume for ATS keyword alignment"),
                        React.createElement('div', { className: "inline-flex items-center gap-2 sm:gap-4 glass rounded-xl sm:rounded-2xl px-4 sm:px-6 md:px-8 py-3 sm:py-4 shadow-xl card-hover flex-wrap justify-center text-xs sm:text-sm" },
                            userEmail ? React.createElement(React.Fragment, null,
                                React.createElement('div', { className: "flex items-center gap-1 sm:gap-2" },
                                    React.createElement('span', { className: "text-xl sm:text-2xl" }, ""),
                                    React.createElement('div', { className: "hidden sm:block" },
                                        React.createElement('span', { className: "text-xs text-gray-600 block" }, "Signed in as"),
                                        React.createElement('span', { className: "text-xs sm:text-sm font-semibold text-gray-800 truncate max-w-[120px] sm:max-w-none" }, userEmail)
                                    ),
                                    React.createElement('div', { className: "sm:hidden text-xs font-semibold text-gray-800 truncate max-w-[100px]" }, userEmail.split('@')[0])
                                ),
                                React.createElement('div', { className: "h-6 sm:h-8 w-px bg-gray-300 hidden sm:block" }),
                                React.createElement('button', {
                                    onClick: () => setShowSavedResumes(true),
                                    className: "px-2 sm:px-4 py-1.5 sm:py-2 bg-gray-600 text-white rounded-lg font-medium hover:bg-gray-700 active:bg-gray-800 transition-all text-xs sm:text-sm flex items-center gap-1 sm:gap-2 touch-manipulation"
                                },
                                    React.createElement('span', null, ""),
                                    React.createElement('span', { className: "hidden sm:inline" }, `Saved (${savedResumes.length})`),
                                    React.createElement('span', { className: "sm:hidden" }, savedResumes.length)
                                ),
                                React.createElement('div', { className: "h-6 sm:h-8 w-px bg-gray-300 hidden sm:block" }),
                                React.createElement('button', {
                                    onClick: () => {
                                        setShowStats(true);
                                        loadUserStats();
                                    },
                                    className: "px-2 sm:px-4 py-1.5 sm:py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 active:bg-blue-800 transition-all text-xs sm:text-sm flex items-center gap-1 sm:gap-2 touch-manipulation"
                                },
                                    React.createElement('span', null, ""),
                                    React.createElement('span', { className: "hidden sm:inline" }, "Stats"),
                                    React.createElement('span', { className: "sm:hidden" }, "")
                                ),
                                React.createElement('div', { className: "h-6 sm:h-8 w-px bg-gray-300 hidden sm:block" }),
                                React.createElement('button', {
                                    onClick: handleSignOut,
                                    className: "px-2 sm:px-4 py-1.5 sm:py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 active:bg-red-800 transition-all text-xs sm:text-sm touch-manipulation"
                                }, "Sign Out")
                            ) : null,
                            React.createElement('div', { className: "h-6 sm:h-8 w-px bg-gray-300" }),
                            React.createElement('div', { className: "flex items-center gap-1 sm:gap-2" },
                                React.createElement('div', null,
                                    React.createElement('span', { className: "text-xs text-gray-600 block hidden sm:block" }, "Credits"),
                                    React.createElement('span', { className: "text-2xl sm:text-3xl font-bold text-gray-900" }, credits)
                                )
                            ),
                            React.createElement('div', { className: "h-6 sm:h-8 w-px bg-gray-300" }),
                            React.createElement('button', {
                                onClick: handleCreditPurchase,
                                className: "px-3 sm:px-4 md:px-6 py-2 sm:py-3 bg-gray-900 text-white rounded-lg sm:rounded-xl font-semibold hover:bg-gray-800 active:bg-gray-700 transition-all shadow-sm hover:shadow-md active:scale-95 flex items-center gap-1 sm:gap-2 text-xs sm:text-sm touch-manipulation"
                            },
                                React.createElement('span', null, ""),
                                React.createElement('span', { className: "hidden sm:inline" }, `Buy ${PURCHASE_BUNDLE} Credits ($2.00)`),
                                React.createElement('span', { className: "sm:hidden" }, `Buy ${PURCHASE_BUNDLE}`)
                            )
                        )
                    ),
                    // Error Display
                    error && React.createElement('div', {
                        className: "mb-4 sm:mb-6 glass rounded-xl border-2 border-red-300 bg-red-50 px-4 sm:px-6 py-3 sm:py-4 shadow-lg animate-slideIn"
                    },
                        React.createElement('div', { className: "flex items-start gap-2 sm:gap-3" },
                            React.createElement('span', { className: "text-xl sm:text-2xl flex-shrink-0" }, ""),
                            React.createElement('p', { className: "text-red-800 font-medium text-sm sm:text-base" }, error)
                        )
                    ),
                    // Analytics Display
                    analytics ? React.createElement('div', {
                        className: "mb-6 glass rounded-lg p-4 sm:p-6 shadow-sm border border-gray-200 bg-white animate-fadeIn"
                    },
                        React.createElement('div', { className: "flex items-center gap-2 mb-4" },
                            React.createElement('span', { className: "text-2xl" }, ""),
                            React.createElement('h3', { className: "text-lg sm:text-xl font-bold text-gray-800" }, "Keyword Match Analysis")
                        ),
                        React.createElement('div', { className: "grid grid-cols-2 sm:grid-cols-3 gap-4 mb-4" },
                            React.createElement('div', { className: "bg-white/60 rounded-lg p-3 sm:p-4 text-center" },
                                React.createElement('div', { className: "text-xs sm:text-sm text-gray-600 mb-1" }, "Original Score"),
                                React.createElement('div', { className: `text-2xl sm:text-3xl font-bold ${analytics.originalScore < 30 ? 'text-red-600' : analytics.originalScore < 60 ? 'text-yellow-600' : 'text-green-600'}` },
                                    `${analytics.originalScore}%`
                                )
                            ),
                            React.createElement('div', { className: "bg-white/60 rounded-lg p-3 sm:p-4 text-center" },
                                React.createElement('div', { className: "text-xs sm:text-sm text-gray-600 mb-1" }, "Tailored Score"),
                                React.createElement('div', { className: `text-2xl sm:text-3xl font-bold ${analytics.tailoredScore < 30 ? 'text-red-600' : analytics.tailoredScore < 60 ? 'text-yellow-600' : 'text-green-600'}` },
                                    `${analytics.tailoredScore}%`
                                )
                            ),
                            React.createElement('div', { className: "bg-white/60 rounded-lg p-3 sm:p-4 text-center col-span-2 sm:col-span-1" },
                                React.createElement('div', { className: "text-xs sm:text-sm text-gray-600 mb-1" }, "Improvement"),
                                React.createElement('div', { className: `text-2xl sm:text-3xl font-bold ${analytics.improvement > 0 ? 'text-green-600' : 'text-gray-600'}` },
                                    `${analytics.improvement > 0 ? '+' : ''}${analytics.improvement}%`
                                )
                            )
                        ),
                        React.createElement('div', { className: "text-xs sm:text-sm text-gray-600 mb-2" },
                            `Matched ${analytics.tailoredMatches} of ${analytics.totalKeywords} keywords from job description`
                        ),
                        analytics.missingKeywords && analytics.missingKeywords.length > 0 && React.createElement('div', { className: "mt-3" },
                            React.createElement('div', { className: "text-xs sm:text-sm font-semibold text-gray-700 mb-2" }, "Top Missing Keywords:"),
                            React.createElement('div', { className: "flex flex-wrap gap-2" },
                                analytics.missingKeywords.slice(0, 5).map((keyword, idx) =>
                                    React.createElement('span', {
                                        key: idx,
                                        className: "px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs"
                                    }, keyword)
                                )
                            )
                        )
                    ) : null,
                    // Improvement Tips Display
                    (improvementTips && improvementTips.length > 0) ? React.createElement('div', {
                        className: "mb-6 glass rounded-lg p-4 sm:p-6 shadow-sm border border-gray-200 bg-white animate-fadeIn"
                    },
                        React.createElement('div', { className: "flex items-center gap-2 mb-4" },
                            React.createElement('span', { className: "text-2xl" }, ""),
                            React.createElement('h3', { className: "text-lg sm:text-xl font-bold text-gray-800" }, "Improvement Tips")
                        ),
                        React.createElement('div', { className: "space-y-3" },
                            improvementTips.map((tip, idx) => React.createElement('div', {
                                key: idx,
                                className: `p-3 sm:p-4 rounded-lg border-l-4 ${
                                    tip.priority === 'high' ? 'bg-red-50 border-red-500' :
                                    tip.priority === 'medium' ? 'bg-yellow-50 border-yellow-500' :
                                    'bg-blue-50 border-blue-500'
                                }`
                            },
                                React.createElement('div', { className: "flex items-start gap-2" },
                                    React.createElement('span', { 
                                        className: `text-sm font-semibold ${
                                            tip.priority === 'high' ? 'text-red-700' :
                                            tip.priority === 'medium' ? 'text-yellow-700' :
                                            'text-blue-700'
                                        }`
                                    }, tip.title),
                                    tip.priority === 'high' && React.createElement('span', { className: "text-xs bg-red-200 text-red-800 px-2 py-0.5 rounded-full" }, "High")
                                ),
                                React.createElement('p', { className: "text-sm text-gray-700 mt-1" }, tip.description),
                                tip.category && React.createElement('span', { className: "text-xs text-gray-500 mt-2 inline-block" }, 
                                    `Category: ${tip.category}`
                                )
                            ))
                        )
                    ) : null,
                    // Main Content
                    React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 lg:gap-8" },
                        // Input Section
                        React.createElement('div', { className: "space-y-6 animate-fadeIn" },
                            React.createElement('div', { className: "glass rounded-2xl shadow-2xl p-6 card-hover border border-white/20" },
                                React.createElement('div', { className: "flex items-center justify-between mb-4" },
                                    React.createElement('label', { className: "flex items-center gap-2 text-base font-bold text-gray-800" },
                                        React.createElement('span', { className: "text-xl" }, ""),
                                        React.createElement('span', null, "Job Description (JD)")
                                    ),
                                    React.createElement('span', { className: "text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full" }, `${jdCharCount} chars`)
                                ),
                                React.createElement('textarea', {
                                    value: jobDescription,
                                    onChange: (e) => setJobDescription(e.target.value),
                                    placeholder: "Paste the job description here...\n\nExample:\n- Required: 5+ years experience\n- Skills: JavaScript, React, Node.js\n- Responsibilities: Lead development team...",
                                    className: "w-full h-48 sm:h-56 md:h-64 p-3 sm:p-4 border border-gray-300 rounded-lg focus:ring-1 focus:ring-gray-900 focus:border-gray-900 resize-none transition-all bg-white text-sm sm:text-base",
                                    'aria-label': "Job Description input",
                                    'aria-describedby': "jd-char-count"
                                }),
                                draftAutoSaved && React.createElement('div', {
                                    id: "draft-saved",
                                    className: "mt-2 text-xs text-green-600 flex items-center gap-1"
                                },
                                    React.createElement('span', null, ""),
                                    React.createElement('span', null, "Draft auto-saved")
                                )
                            ),
                            React.createElement('div', { className: "glass rounded-2xl shadow-2xl p-6 card-hover border border-white/20" },
                                React.createElement('div', { className: "flex items-center justify-between mb-4" },
                                    React.createElement('label', { className: "flex items-center gap-2 text-base font-bold text-gray-800" },
                                        React.createElement('span', { className: "text-xl" }, ""),
                                        React.createElement('span', null, "Current Resume Section")
                                    ),
                                    React.createElement('span', { className: "text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full" }, `${resumeCharCount} chars`)
                                ),
                                // Toggle buttons
                                React.createElement('div', { className: "flex gap-2 mb-4" },
                                    React.createElement('button', {
                                        onClick: () => {
                                            setUploadMode(false);
                                            setUploadedFileName('');
                                        },
                                        className: `px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                                            !uploadMode 
                                                ? 'bg-gray-900 text-white shadow-sm' 
                                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                        }`
                                    }, " Paste"),
                                    React.createElement('button', {
                                        onClick: () => setUploadMode(true),
                                        className: `px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                                            uploadMode 
                                                ? 'bg-gray-900 text-white shadow-sm' 
                                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                        }`
                                    }, " Upload")
                                ),
                                // Conditional rendering based on mode
                                uploadMode ? React.createElement('div', { className: "space-y-4" },
                                    React.createElement('div', { className: "border border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors" },
                                        React.createElement('input', {
                                            type: 'file',
                                            accept: '.txt,.pdf,.docx',
                                            onChange: handleFileUpload,
                                            className: "hidden",
                                            id: "resume-upload"
                                        }),
                                        React.createElement('label', {
                                            htmlFor: "resume-upload",
                                            className: "cursor-pointer flex flex-col items-center gap-3"
                                        },
                                            React.createElement('span', { className: "text-4xl" }, ""),
                                            React.createElement('div', { className: "flex flex-col items-center gap-1" },
                                                React.createElement('span', { className: "text-gray-900 font-semibold" }, "Click to upload"),
                                                React.createElement('span', { className: "text-gray-600 text-sm" }, "or drag and drop")
                                            ),
                                            React.createElement('p', { className: "text-xs text-gray-500" }, "TXT, PDF, or DOCX (Max 10MB)")
                                        ),
                                        uploadedFileName && React.createElement('p', { className: "mt-4 text-sm text-gray-700 font-medium" }, 
                                            ` ${uploadedFileName}`
                                        )
                                    ),
                                    resumeSection && React.createElement('div', { className: "mt-4" },
                                        React.createElement('textarea', {
                                            value: resumeSection,
                                            onChange: (e) => setResumeSection(e.target.value),
                                            placeholder: "Text extracted from file will appear here...",
                                            className: "w-full h-48 p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-none transition-all bg-white/50 backdrop-blur-sm"
                                        })
                                    )
                                ) : React.createElement('textarea', {
                                    value: resumeSection,
                                    onChange: (e) => setResumeSection(e.target.value),
                                    placeholder: "Paste the resume section you want to tailor here...\n\nExample:\nSoftware Engineer | Tech Corp | 2020-2024\n- Developed web applications using React\n- Collaborated with cross-functional teams...",
                                    className: "w-full h-48 sm:h-56 md:h-64 p-3 sm:p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-none transition-all bg-white/50 backdrop-blur-sm text-sm sm:text-base"
                                })
                            ),
                            React.createElement('button', {
                                onClick: generateTailoredResume,
                                disabled: isGenerating || credits < CREDIT_COST,
                                className: `w-full py-4 sm:py-5 rounded-xl font-bold text-base sm:text-lg transition-all transform touch-manipulation ${
                                    isGenerating || credits < CREDIT_COST 
                                        ? 'bg-gray-400 text-white cursor-wait opacity-75' 
                                        : 'bg-gray-900 text-white hover:bg-gray-800 active:bg-gray-700 shadow-sm hover:shadow-md active:scale-95'
                                } flex items-center justify-center gap-3 ${isGenerating ? 'animate-pulse' : ''}`,
                                'aria-label': "Generate Tailored Resume",
                                title: "Press Ctrl+Enter (or Cmd+Enter on Mac) to generate"
                            },
                                isGenerating ? [
                                    React.createElement('div', { 
                                        key: 'spinner', 
                                        className: "w-6 h-6 border-3 border-white border-t-transparent rounded-full animate-spin" 
                                    }),
                                    React.createElement('span', { 
                                        key: 'text', 
                                        className: "font-semibold flex items-center gap-1" 
                                    }, 
                                        "Generating",
                                        React.createElement('span', { className: "animate-dot-1" }, ""),
                                        React.createElement('span', { className: "animate-dot-2" }, ""),
                                        React.createElement('span', { className: "animate-dot-3" }, "")
                                    )
                                ] : [
                                    React.createElement('span', { key: 'icon', className: "text-xl" }, ""),
                                    React.createElement('span', { key: 'text' }, `Generate Tailored Resume (${CREDIT_COST} Credit)`)
                                ]
                            )
                        ),
                        // Output Section
                        React.createElement('div', { className: "glass rounded-2xl shadow-2xl p-6 card-hover border border-white/20 animate-fadeIn" },
                            React.createElement('div', { className: "flex justify-between items-center mb-4" },
                                React.createElement('label', { className: "flex items-center gap-2 text-base font-bold text-gray-800" },
                                    React.createElement('span', { className: "text-xl" }, ""),
                                    React.createElement('span', null, "Tailored Resume Section")
                                ),
                                tailoredText && React.createElement('div', { className: "flex gap-2 flex-wrap" },
                                    React.createElement('button', {
                                        onClick: copyToClipboard,
                                        className: "px-3 sm:px-4 md:px-5 py-2 sm:py-2.5 bg-green-600 text-white rounded-lg sm:rounded-xl hover:bg-green-700 active:bg-green-800 transition-all shadow-lg hover:shadow-xl active:scale-95 flex items-center gap-1 sm:gap-2 font-semibold text-xs sm:text-sm touch-manipulation"
                                    },
                                        React.createElement('span', null, ""),
                                        React.createElement('span', null, "Copy")
                                    ),
                                    React.createElement('button', {
                                        onClick: exportToPDF,
                                        className: "px-3 sm:px-4 md:px-5 py-2 sm:py-2.5 bg-red-600 text-white rounded-lg sm:rounded-xl hover:bg-red-700 active:bg-red-800 transition-all shadow-lg hover:shadow-xl active:scale-95 flex items-center gap-1 sm:gap-2 font-semibold text-xs sm:text-sm touch-manipulation"
                                    },
                                        React.createElement('span', null, ""),
                                        React.createElement('span', null, "PDF")
                                    ),
                                    React.createElement('button', {
                                        onClick: exportToDOCX,
                                        className: "px-3 sm:px-4 md:px-5 py-2 sm:py-2.5 bg-blue-600 text-white rounded-lg sm:rounded-xl hover:bg-blue-700 active:bg-blue-800 transition-all shadow-lg hover:shadow-xl active:scale-95 flex items-center gap-1 sm:gap-2 font-semibold text-xs sm:text-sm touch-manipulation"
                                    },
                                        React.createElement('span', null, ""),
                                        React.createElement('span', null, "DOCX")
                                    ),
                                    userId && React.createElement('button', {
                                        onClick: saveTailoredResume,
                                        className: "px-3 sm:px-4 md:px-5 py-2 sm:py-2.5 bg-gray-900 text-white rounded-lg sm:rounded-xl hover:bg-gray-800 active:bg-gray-700 transition-all shadow-sm hover:shadow-md active:scale-95 flex items-center gap-1 sm:gap-2 font-semibold text-xs sm:text-sm touch-manipulation"
                                    },
                                        React.createElement('span', null, ""),
                                        React.createElement('span', null, "Save")
                                    )
                                )
                            ),
                            React.createElement('div', {
                                className: "border-2 border-gray-200 rounded-xl p-4 sm:p-6 h-[400px] sm:h-[500px] md:h-[600px] overflow-y-auto bg-white/60 backdrop-blur-sm shadow-inner text-sm sm:text-base"
                            }, isGenerating ? React.createElement('div', { className: "h-full flex flex-col items-center justify-center space-y-4" },
                                React.createElement('div', { className: "relative w-16 h-16" },
                                    React.createElement('div', { className: "absolute inset-0 border-4 border-indigo-200 rounded-full" }),
                                    React.createElement('div', { className: "absolute inset-0 border-4 border-orange-500 rounded-full border-t-transparent animate-spin" })
                                ),
                                React.createElement('p', { className: "text-gray-700 font-semibold text-lg" }, "Tailoring your resume"),
                                React.createElement('div', { className: "flex items-center gap-1" },
                                    React.createElement('span', { className: "animate-dot-1 text-gray-600" }, ""),
                                    React.createElement('span', { className: "animate-dot-2 text-gray-600" }, ""),
                                    React.createElement('span', { className: "animate-dot-3 text-gray-600" }, "")
                                ),
                                React.createElement('p', { className: "text-gray-500 text-sm" }, "Analyzing job description and optimizing keywords")
                            ) : tailoredText ? React.createElement('div', { className: "space-y-4" },
                                React.createElement('p', {
                                    className: "text-gray-800 whitespace-pre-wrap leading-relaxed text-base"
                                }, tailoredText),
                                React.createElement('div', { className: "pt-4 border-t border-gray-200 flex items-center gap-2 text-sm text-gray-500" },
                                    React.createElement('span', null, ""),
                                    React.createElement('span', null, `${tailoredText.split(/\s+/).length} words  ${tailoredText.length} characters`)
                                )
                            ) : React.createElement('div', { className: "h-full flex items-center justify-center" },
                                React.createElement('div', { className: "text-center" },
                                    React.createElement('div', { className: "text-6xl mb-4 opacity-50" }, ""),
                                    React.createElement('p', { className: "text-gray-400 italic text-lg" }, "Your tailored resume section will appear here..."),
                                    React.createElement('p', { className: "text-gray-400 text-sm mt-2" }, "Fill in the inputs and click Generate")
                                )
                            ))
                        )
                    ),
                    // Auth Modal
                    showAuthModal && React.createElement('div', {
                        className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",
                        onClick: () => setShowAuthModal(false)
                    },
                        React.createElement('div', {
                            className: "glass rounded-2xl p-8 max-w-md w-full shadow-2xl",
                            onClick: (e) => e.stopPropagation()
                        },
                            React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-6 text-center" },
                                authMode === 'signin' ? 'Sign In to ResumeForge' : 'Create Account'
                            ),
                            error && React.createElement('div', {
                                className: "mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm"
                            }, error),
                            React.createElement('div', { className: "space-y-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-semibold text-gray-700 mb-2" }, "Email"),
                                    React.createElement('input', {
                                        type: 'email',
                                        value: authEmail,
                                        onChange: (e) => setAuthEmail(e.target.value),
                                        placeholder: "your@email.com",
                                        className: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-1 focus:ring-gray-900 focus:border-gray-900 transition-all"
                                    })
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-semibold text-gray-700 mb-2" }, "Password"),
                                    React.createElement('input', {
                                        type: 'password',
                                        value: authPassword,
                                        onChange: (e) => setAuthPassword(e.target.value),
                                        placeholder: "",
                                        className: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-1 focus:ring-gray-900 focus:border-gray-900 transition-all"
                                    })
                                ),
                                React.createElement('button', {
                                    onClick: authMode === 'signin' ? handleSignIn : handleSignUp,
                                    disabled: authLoading,
                                    className: `w-full py-3 bg-gray-900 text-white rounded-xl font-semibold hover:bg-gray-800 transition-all ${authLoading ? 'opacity-50 cursor-not-allowed' : ''}`
                                }, authLoading ? 'Loading...' : (authMode === 'signin' ? 'Sign In' : 'Sign Up')),
                                React.createElement('div', { className: "text-center text-sm text-gray-600" },
                                    authMode === 'signin' ? 
                                        React.createElement(React.Fragment, null,
                                            "Don't have an account? ",
                                            React.createElement('button', {
                                                onClick: () => {
                                                    setAuthMode('signup');
                                                    setError(null);
                                                },
                                                className: "text-gray-900 hover:text-gray-700 hover:underline font-semibold"
                                            }, "Sign Up")
                                        ) :
                                        React.createElement(React.Fragment, null,
                                            "Already have an account? ",
                                            React.createElement('button', {
                                                onClick: () => {
                                                    setAuthMode('signin');
                                                    setError(null);
                                                },
                                                className: "text-gray-900 hover:text-gray-700 hover:underline font-semibold"
                                            }, "Sign In")
                                        )
                                )
                            )
                        )
                    ),
                    // Saved Resumes Modal
                    showSavedResumes ? React.createElement('div', {
                        className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",
                        onClick: () => setShowSavedResumes(false),
                        role: "dialog",
                        'aria-modal': "true",
                        'aria-label': "Saved Resumes"
                    },
                        React.createElement('div', {
                            className: "glass rounded-2xl p-4 sm:p-8 max-w-4xl w-full max-h-[80vh] overflow-y-auto shadow-2xl",
                            onClick: (e) => e.stopPropagation()
                        },
                            React.createElement('div', { className: "flex justify-between items-center mb-4 sm:mb-6" },
                                React.createElement('h2', { className: "text-xl sm:text-2xl font-bold text-gray-800" }, "Saved Resumes"),
                                React.createElement('button', {
                                    onClick: () => setShowSavedResumes(false),
                                    className: "text-gray-500 hover:text-gray-700 text-2xl",
                                    'aria-label': "Close saved resumes modal"
                                }, "")
                            ),
                            savedResumes.length > 0 ? React.createElement('div', { className: "mb-4" },
                                React.createElement('input', {
                                    type: 'text',
                                    value: searchQuery,
                                    onChange: (e) => setSearchQuery(e.target.value),
                                    placeholder: "Search saved resumes...",
                                    className: "w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm",
                                    'aria-label': "Search saved resumes"
                                })
                            ) : null,
                            savedResumes.length === 0 ? React.createElement('div', { className: "text-center py-12" },
                                React.createElement('div', { className: "text-6xl mb-4 opacity-50" }, ""),
                                React.createElement('p', { className: "text-gray-500 text-lg" }, "No saved resumes yet"),
                                React.createElement('p', { className: "text-gray-400 text-sm mt-2" }, "Generate and save a tailored resume to see it here")
                            ) : filteredSavedResumes.length === 0 ? React.createElement('div', { className: "text-center py-12" },
                                React.createElement('p', { className: "text-gray-500 text-lg" }, "No resumes match your search"),
                                React.createElement('button', {
                                    onClick: () => setSearchQuery(''),
                                    className: "mt-2 text-gray-900 hover:text-gray-700 text-sm underline"
                                }, "Clear search")
                            ) : React.createElement('div', { className: "space-y-4" },
                                filteredSavedResumes.map((resume) => React.createElement('div', {
                                    key: resume.id,
                                    className: "border border-gray-200 rounded-lg p-4 sm:p-6 hover:border-gray-300 transition-all bg-white"
                                },
                                    editingResumeId === resume.id ? React.createElement('div', { className: "flex items-center gap-2 mb-3" },
                                        React.createElement('input', {
                                            type: 'text',
                                            value: editingResumeName,
                                            onChange: (e) => setEditingResumeName(e.target.value),
                                            className: "flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-gray-900 focus:border-gray-900 text-sm",
                                            placeholder: "Resume name...",
                                            autoFocus: true,
                                            onKeyDown: (e) => {
                                                if (e.key === 'Enter') {
                                                    updateResumeName(resume.id, editingResumeName);
                                                } else if (e.key === 'Escape') {
                                                    setEditingResumeId(null);
                                                    setEditingResumeName('');
                                                }
                                            }
                                        }),
                                        React.createElement('button', {
                                            onClick: () => updateResumeName(resume.id, editingResumeName),
                                            className: "px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm",
                                            'aria-label': "Save name"
                                        }, ""),
                                        React.createElement('button', {
                                            onClick: () => {
                                                setEditingResumeId(null);
                                                setEditingResumeName('');
                                            },
                                            className: "px-3 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm",
                                            'aria-label': "Cancel editing"
                                        }, "")
                                    ) : React.createElement('div', { className: "flex justify-between items-start mb-3" },
                                        React.createElement('div', { className: "flex-1" },
                                            React.createElement('p', { className: "text-xs text-gray-500 mb-1" },
                                                resume.createdAt ? new Date(resume.createdAt.seconds * 1000).toLocaleDateString() : 'Unknown date'
                                            ),
                                            React.createElement('p', { 
                                                className: "text-sm font-semibold text-gray-700 mb-2 line-clamp-2 cursor-pointer hover:text-gray-900",
                                                onClick: () => {
                                                    setEditingResumeId(resume.id);
                                                    setEditingResumeName(resume.name || resume.jobDescription?.substring(0, 50) || 'Untitled');
                                                },
                                                title: "Click to rename"
                                            },
                                                resume.name || (resume.jobDescription ? resume.jobDescription.substring(0, 100) + '...' : 'Untitled Resume')
                                            )
                                        ),
                                        React.createElement('div', { className: "flex gap-2 flex-wrap" },
                                            React.createElement('button', {
                                                onClick: () => loadSavedResume(resume),
                                                className: "px-3 sm:px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 active:bg-gray-700 transition-all text-xs sm:text-sm font-medium touch-manipulation",
                                                'aria-label': "Load this resume"
                                            }, "Load"),
                                            React.createElement('button', {
                                                onClick: () => {
                                                    setEditingResumeId(resume.id);
                                                    setEditingResumeName(resume.name || resume.jobDescription?.substring(0, 50) || 'Untitled');
                                                },
                                                className: "px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 active:bg-blue-800 transition-all text-xs sm:text-sm font-medium touch-manipulation",
                                                'aria-label': "Rename this resume"
                                            }, ""),
                                            React.createElement('button', {
                                                onClick: () => setShowDeleteConfirm(resume.id),
                                                className: "px-3 sm:px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 active:bg-red-800 transition-all text-xs sm:text-sm font-medium touch-manipulation",
                                                'aria-label': "Delete this resume"
                                            }, "")
                                        )
                                    ),
                                    React.createElement('div', { className: "text-xs text-gray-500" },
                                        React.createElement('span', null, `Original: ${resume.originalSection ? resume.originalSection.length : 0} chars  `),
                                        React.createElement('span', null, `Tailored: ${resume.tailoredSection ? resume.tailoredSection.length : 0} chars`)
                                    )
                                ))
                            ),
                            // Delete Confirmation Dialog
                            showDeleteConfirm ? React.createElement('div', {
                                className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",
                                onClick: () => setShowDeleteConfirm(null)
                            },
                                React.createElement('div', {
                                    className: "glass rounded-2xl p-6 max-w-md w-full shadow-2xl",
                                    onClick: (e) => e.stopPropagation()
                                },
                                    React.createElement('h3', { className: "text-xl font-bold text-gray-800 mb-4" }, "Delete Resume?"),
                                    React.createElement('p', { className: "text-gray-600 mb-6" }, "Are you sure you want to delete this saved resume? This action cannot be undone."),
                                    React.createElement('div', { className: "flex gap-3 justify-end" },
                                        React.createElement('button', {
                                            onClick: () => setShowDeleteConfirm(null),
                                            className: "px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all font-medium"
                                        }, "Cancel"),
                                        React.createElement('button', {
                                            onClick: () => deleteSavedResume(showDeleteConfirm),
                                            className: "px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all font-medium",
                                            'aria-label': "Confirm delete"
                                        }, "Delete")
                                    )
                                )
                            ) : null
                        )
                    ) : null,
                    // Statistics Dashboard Modal
                    showStats ? React.createElement('div', {
                        className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",
                        onClick: () => setShowStats(false),
                        role: "dialog",
                        'aria-modal': "true",
                        'aria-label': "Usage Statistics"
                    },
                        React.createElement('div', {
                            className: "glass rounded-2xl p-4 sm:p-8 max-w-4xl w-full max-h-[80vh] overflow-y-auto shadow-2xl",
                            onClick: (e) => e.stopPropagation()
                        },
                            React.createElement('div', { className: "flex justify-between items-center mb-4 sm:mb-6" },
                                React.createElement('h2', { className: "text-xl sm:text-2xl font-bold text-gray-800" }, "Usage Statistics"),
                                React.createElement('button', {
                                    onClick: () => setShowStats(false),
                                    className: "text-gray-500 hover:text-gray-700 text-2xl",
                                    'aria-label': "Close statistics modal"
                                }, "")
                            ),
                            userStats ? React.createElement('div', { className: "space-y-6" },
                                React.createElement('div', { className: "grid grid-cols-2 sm:grid-cols-4 gap-4" },
                                    React.createElement('div', { className: "bg-white rounded-lg p-4 border border-gray-200 text-center" },
                                        React.createElement('div', { className: "text-xs sm:text-sm text-gray-600 mb-1" }, "Total Generations"),
                                        React.createElement('div', { className: "text-2xl sm:text-3xl font-bold text-gray-900" }, userStats.totalGenerations || 0)
                                    ),
                                    React.createElement('div', { className: "bg-white rounded-lg p-4 border border-gray-200 text-center" },
                                        React.createElement('div', { className: "text-xs sm:text-sm text-gray-600 mb-1" }, "Credits Used"),
                                        React.createElement('div', { className: "text-2xl sm:text-3xl font-bold text-gray-900" }, userStats.totalCreditsUsed || 0)
                                    ),
                                    React.createElement('div', { className: "bg-white rounded-lg p-4 border border-gray-200 text-center" },
                                        React.createElement('div', { className: "text-xs sm:text-sm text-gray-600 mb-1" }, "Saved Resumes"),
                                        React.createElement('div', { className: "text-2xl sm:text-3xl font-bold text-gray-900" }, userStats.savedResumesCount || 0)
                                    ),
                                    React.createElement('div', { className: "bg-white rounded-lg p-4 border border-gray-200 text-center" },
                                        React.createElement('div', { className: "text-xs sm:text-sm text-gray-600 mb-1" }, "Avg Improvement"),
                                        React.createElement('div', { className: `text-2xl sm:text-3xl font-bold ${(userStats.averageImprovement || 0) > 0 ? 'text-green-600' : 'text-gray-600'}` },
                                            `${userStats.averageImprovement || 0}%`
                                        )
                                    )
                                ),
                                userStats.generationsByDate && Object.keys(userStats.generationsByDate).length > 0 && React.createElement('div', { className: "bg-white rounded-lg p-4 border border-gray-200" },
                                    React.createElement('h3', { className: "text-lg font-bold text-gray-800 mb-4" }, "Recent Activity"),
                                    React.createElement('div', { className: "space-y-2" },
                                        Object.entries(userStats.generationsByDate)
                                            .sort((a, b) => b[0].localeCompare(a[0]))
                                            .slice(0, 7)
                                            .map(([date, count]) => React.createElement('div', {
                                                key: date,
                                                className: "flex justify-between items-center py-2 border-b border-gray-100 last:border-0"
                                            },
                                                React.createElement('span', { className: "text-sm text-gray-700" }, 
                                                    new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })
                                                ),
                                                React.createElement('span', { className: "text-sm font-semibold text-gray-900" }, `${count} generation${count !== 1 ? 's' : ''}`)
                                            ))
                                    )
                                ),
                                userStats.lastGenerationDate && React.createElement('div', { className: "text-xs text-gray-500 text-center" },
                                    `Last generation: ${userStats.lastGenerationDate.seconds ? new Date(userStats.lastGenerationDate.seconds * 1000).toLocaleString() : 'Never'}`
                                )
                            ) : React.createElement('div', { className: "text-center py-12" },
                                React.createElement('div', { className: "text-6xl mb-4 opacity-50" }, ""),
                                React.createElement('p', { className: "text-gray-500 text-lg" }, "No statistics yet"),
                                React.createElement('p', { className: "text-gray-400 text-sm mt-2" }, "Generate your first tailored resume to see your stats")
                            )
                        )
                    ) : null,
                    // Footer
                    React.createElement('div', { className: "mt-12 text-center animate-fadeIn" },
                        React.createElement('div', { className: "glass rounded-xl px-6 py-4 inline-block" },
                            React.createElement('p', { className: "text-gray-700 font-medium flex items-center justify-center gap-2" },
                                React.createElement('span', null, ""),
                                React.createElement('span', null, "Powered by Google Gemini AI"),
                                React.createElement('span', { className: "mx-2" }, ""),
                                React.createElement('span', null, " Optimized for ATS keyword matching")
                            )
                        )
                    )
                )
            );
        }

        // Wait for Firebase modules to load
        let firebaseCheckAttempts = 0;
        const maxAttempts = 50; // 5 seconds max wait
        
        console.log('Starting Firebase module check...');
        
        const checkFirebase = setInterval(() => {
            firebaseCheckAttempts++;
            
            if (window.firebaseModules && window.firebaseModules.initializeApp) {
                clearInterval(checkFirebase);
                console.log('Firebase modules loaded, initializing app...');
                try {
                    // Extract Firebase functions from window.firebaseModules
                    initializeApp = window.firebaseModules.initializeApp;
                    getAuth = window.firebaseModules.getAuth;
                    signInAnonymously = window.firebaseModules.signInAnonymously;
                    onAuthStateChanged = window.firebaseModules.onAuthStateChanged;
                    createUserWithEmailAndPassword = window.firebaseModules.createUserWithEmailAndPassword;
                    signInWithEmailAndPassword = window.firebaseModules.signInWithEmailAndPassword;
                    signOut = window.firebaseModules.signOut;
                    getFirestore = window.firebaseModules.getFirestore;
                    doc = window.firebaseModules.doc;
                    getDoc = window.firebaseModules.getDoc;
                    setDoc = window.firebaseModules.setDoc;
                    updateDoc = window.firebaseModules.updateDoc;
                    onSnapshot = window.firebaseModules.onSnapshot;
                    serverTimestamp = window.firebaseModules.serverTimestamp;
                    collection = window.firebaseModules.collection;
                    addDoc = window.firebaseModules.addDoc;
                    getDocs = window.firebaseModules.getDocs;
                    deleteDoc = window.firebaseModules.deleteDoc;
                    query = window.firebaseModules.query;
                    orderBy = window.firebaseModules.orderBy;
                    getFunctions = window.firebaseModules.getFunctions;
                    httpsCallable = window.firebaseModules.httpsCallable;
                    
                    // Initialize Firebase now that modules are loaded
                    app = initializeApp(FIREBASE_CONFIG);
                    auth = getAuth(app);
                    db = getFirestore(app);
                    functions = getFunctions(app);
                    
                    console.log('Firebase initialized, rendering React app...');
                    const rootElement = document.getElementById('root');
                    if (!rootElement) {
                        throw new Error('Root element not found');
                    }
                    const root = ReactDOM.createRoot(rootElement);
                    root.render(React.createElement(App));
                    console.log('App rendered successfully');
                } catch (error) {
                    console.error('Error initializing Firebase or rendering app:', error);
                    console.error('Error stack:', error.stack);
                    const rootElement = document.getElementById('root');
                    if (rootElement) {
                        rootElement.innerHTML = `
                            <div style="padding: 20px; text-align: center; font-family: system-ui, -apple-system, sans-serif;">
                                <h1 style="color: #dc2626; margin-bottom: 10px;">Error Loading Application</h1>
                                <p style="color: #6b7280;">${error.message || 'Unknown error occurred'}</p>
                                <p style="color: #6b7280; margin-top: 10px;">Please refresh the page or contact support if the problem persists.</p>
                                <pre style="text-align: left; margin-top: 20px; padding: 10px; background: #f3f4f6; border-radius: 4px; font-size: 12px;">${error.stack || ''}</pre>
                            </div>
                        `;
                    }
                }
            } else if (firebaseCheckAttempts >= maxAttempts) {
                clearInterval(checkFirebase);
                console.error('Firebase modules failed to load after 5 seconds');
                console.error('window.firebaseModules:', window.firebaseModules);
                const rootElement = document.getElementById('root');
                if (rootElement) {
                    rootElement.innerHTML = `
                        <div style="padding: 20px; text-align: center; font-family: system-ui, -apple-system, sans-serif;">
                            <h1 style="color: #dc2626; margin-bottom: 10px;">Application Loading Error</h1>
                            <p style="color: #6b7280;">Firebase modules failed to load. Please check your internet connection and refresh the page.</p>
                            <p style="color: #6b7280; margin-top: 10px; font-size: 12px;">Check the browser console for more details.</p>
                        </div>
                    `;
                }
            } else if (firebaseCheckAttempts % 10 === 0) {
                console.log(`Still waiting for Firebase modules... (attempt ${firebaseCheckAttempts}/${maxAttempts})`);
            }
        }, 100);
    </script>
</body>
</html>

