<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ResumeForge - AI-Powered Resume Tailoring</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Optimize your resume for ATS keyword alignment. Tailor your resume to job descriptions with AI-powered keyword matching and improvement tips.">
    <meta name="keywords" content="resume tailor, ATS resume, resume optimization, keyword matching, resume builder, job application, resume improvement">
    <meta name="author" content="ResumeForge">
    <meta name="theme-color" content="#7c3aed">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://resumeforgeapp.com/">
    <meta property="og:title" content="ResumeForge - AI-Powered Resume Tailoring">
    <meta property="og:description" content="Optimize your resume for ATS keyword alignment. Tailor your resume to job descriptions with AI-powered keyword matching.">
    <meta property="og:image" content="https://resumeforgeapp.com/og-image.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://resumeforgeapp.com/">
    <meta property="twitter:title" content="ResumeForge - AI-Powered Resume Tailoring">
    <meta property="twitter:description" content="Optimize your resume for ATS keyword alignment. Tailor your resume to job descriptions with AI-powered keyword matching.">
    <meta property="twitter:image" content="https://resumeforgeapp.com/og-image.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192x192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ResumeForge">
    
    <!-- Resource Hints for Performance -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://www.gstatic.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="https://unpkg.com">
    <link rel="dns-prefetch" href="https://www.gstatic.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    
    <!-- Tailwind CSS -->
    <!-- Note: CDN version is for development. For production, use PostCSS plugin or Tailwind CLI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- PDF.js for PDF parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Configure PDF.js worker
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }
    </script>
    
    <!-- Mammoth.js for DOCX parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInAnonymously, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, query, where, onSnapshot, deleteDoc, doc, getDoc, setDoc, updateDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getFunctions, httpsCallable } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js';
        
        // Make Firebase functions available globally
        window.firebaseModules = {
            initializeApp,
            getAuth,
            signInAnonymously,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            getFirestore,
            collection,
            addDoc,
            query,
            where,
            onSnapshot,
            deleteDoc,
            doc,
            getDoc,
            setDoc,
            updateDoc,
            serverTimestamp,
            getFunctions,
            httpsCallable
        };
    </script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
        
        /* Custom Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }
        
        .animate-pulse-slow {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .animate-spin-slow {
            animation: spin 1s linear infinite;
        }
        
        /* Smooth transitions */
        * {
            transition-property: color, background-color, border-color, transform, box-shadow;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 200ms;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* Mobile touch optimizations */
        .touch-manipulation {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Improve focus visibility for accessibility */
        *:focus-visible {
            outline: 2px solid #7c3aed;
            outline-offset: 2px;
        }
        
        /* Skip to main content link for screen readers */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #7c3aed;
            color: white;
            padding: 8px;
            text-decoration: none;
            z-index: 100;
        }
        
        .skip-link:focus {
            top: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Configuration placeholders - REPLACE THESE WITH YOUR ACTUAL VALUES
        const APP_ID = 'resume-tailor-v1'; // Matches Firebase Functions config
        // ⚠️ SECURITY WARNING: This contains real production Firebase configuration
        // While Firebase API keys are meant to be public in client-side code, having production
        // configs hardcoded here exposes your specific Firebase project instance.
        // 
        // For better security practices:
        // 1. Consider using environment variables or build-time configuration
        // 2. Use different Firebase projects for development/staging/production
        // 3. Implement Firebase App Check to protect against abuse
        // 4. Monitor Firebase usage and set up alerts for unusual activity
        //
        // Firebase configuration for resume-tailor project
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyALXDoW17ultZ3rlSNr9oL4GE6DLCQa3tI",
            authDomain: "resume-tailor-f4f7c.firebaseapp.com",
            projectId: "resume-tailor-f4f7c",
            storageBucket: "resume-tailor-f4f7c.firebasestorage.app",
            messagingSenderId: "697064626570",
            appId: "1:697064626570:web:b9c65f441c8561bab51073",
            measurementId: "G-BJ2ZN1BP5F"
        };
        
        // NOTE: Gemini API key is now stored server-side in Firebase Functions
        // No API key needed in frontend code - calls go through generateTailoredResume Cloud Function
        
        // Stripe Configuration - REPLACE WITH YOUR STRIPE PUBLISHABLE KEY
        const STRIPE_PUBLISHABLE_KEY = 'pk_test_51RbOo8KfMIBsUfylIZIdikgVnL7C1Mfdj61d8AJj3splHLHAloyepn6y4Olte2QtGviWpBE8OuYqN6F20LKwLJQl00aZ5sdgj0';
        const STRIPE_PRICE_ID = 'price_1Skud7QQl8oxreSlbAkOS13N'; // $1.00 for 5 credits - UPDATE THIS with your actual Stripe price ID
        
        // Firebase initialization
        let app, auth, db, functions;
        let currentUserId = null;
        
        function initializeFirebase() {
            if (!FIREBASE_CONFIG || typeof FIREBASE_CONFIG !== 'object') {
                console.error('Firebase config is not properly set');
                return false;
            }
            
            try {
                const { initializeApp, getAuth, getFirestore, getFunctions } = window.firebaseModules;
                app = initializeApp(FIREBASE_CONFIG);
                auth = getAuth(app);
                db = getFirestore(app);
                functions = getFunctions(app);
                return true;
            } catch (error) {
                console.error('Firebase initialization error:', error);
                return false;
            }
        }
        
        function authenticateUser() {
            if (!auth) return Promise.resolve(false);
            
            return new Promise((resolve) => {
                const { onAuthStateChanged } = window.firebaseModules;
                
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        resolve(true);
                    } else {
                        // Don't auto-authenticate - require email/password
                        currentUserId = null;
                        resolve(false);
                    }
                });
            });
        }
        
        async function signUpWithEmail(email, password) {
            if (!auth) return { success: false, error: 'Auth not initialized' };
            
            try {
                const { createUserWithEmailAndPassword } = window.firebaseModules;
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                currentUserId = userCredential.user.uid;
                
                // Initialize user data in Firestore
                await initializeUserData(userCredential.user.uid, email);
                
                return { success: true, user: userCredential.user };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        async function signInWithEmail(email, password) {
            if (!auth) return { success: false, error: 'Auth not initialized' };
            
            try {
                const { signInWithEmailAndPassword } = window.firebaseModules;
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                currentUserId = userCredential.user.uid;
                return { success: true, user: userCredential.user };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        async function signOutUser() {
            if (!auth) return;
            
            try {
                const { signOut } = window.firebaseModules;
                await signOut(auth);
                currentUserId = null;
                return { success: true };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        async function initializeUserData(userId, email) {
            if (!db) return;
            
            const { doc, setDoc, serverTimestamp } = window.firebaseModules;
            const userRef = doc(db, `artifacts/${APP_ID}/users/${userId}`);
            
            const userData = {
                email: email,
                subscriptionStatus: 'free',
                dailyGenerations: 0,
                lastGenerationDate: null,
                totalGenerations: 0,
                createdAt: serverTimestamp()
            };
            
            await setDoc(userRef, userData, { merge: true });
        }
        
        async function getUserSubscriptionData() {
            if (!db) {
                console.error('Firestore database not initialized');
                throw new Error('Database not initialized. Please refresh the page.');
            }
            
            if (!currentUserId) {
                console.error('User ID not available');
                throw new Error('User not authenticated');
            }
            
            try {
                const { doc, getDoc } = window.firebaseModules;
                const userRef = doc(db, `artifacts/${APP_ID}/users/${currentUserId}`);
                const userSnap = await getDoc(userRef);
                
                if (userSnap.exists()) {
                    const data = userSnap.data();
                    return {
                        credits: data.credits || 0,
                        hasPaidOnce: data.hasPaidOnce || false,
                    };
                }
                // Document doesn't exist yet - return default values
                return {
                    credits: 0,
                    hasPaidOnce: false,
                };
            } catch (error) {
                // Handle permission errors gracefully
                if (error.code === 'permission-denied' || error.message?.includes('permission')) {
                    console.warn('Permission denied reading user data. This may be from cached code or Firestore rules.');
                    console.warn('If this persists after hard refresh, check Firestore security rules.');
                    // Return default values instead of throwing - allows app to continue
                    return {
                        credits: 0,
                        hasPaidOnce: false,
                    };
                }
                
                // Handle network errors
                if (error.code === 'unavailable' || error.message?.includes('network') || error.message?.includes('fetch')) {
                    console.error('Network error getting user data:', error);
                    throw new Error('Network error. Please check your internet connection.');
                }
                
                console.error('Error getting user data:', error);
                // Return default values instead of throwing for unknown errors
                // This prevents the app from breaking
                return {
                    credits: 0,
                    hasPaidOnce: false,
                };
            }
        }
        
        async function checkUsageLimit() {
            // No free generations - only credits
                const userData = await getUserSubscriptionData();
            if (!userData) {
                return { 
                    canGenerate: false, 
                    remaining: 0, 
                    message: 'No credits available. Please purchase credits to continue.', 
                    isFree: false 
                };
            }
            
            const { credits } = userData;
            
            // Check if user has credits
            if (credits > 0) {
                return { 
                    canGenerate: true, 
                    remaining: credits, 
                                    message: `${credits} credit${credits !== 1 ? 's' : ''} available`,
                    isFree: false 
                };
            }
            
            return { 
                canGenerate: false, 
                remaining: 0, 
                message: 'No credits available. Please purchase credits to continue.', 
                isFree: false 
            };
        }
        
        async function incrementUsage() {
            if (!db || !currentUserId) return;
            
            try {
                const { doc, getDoc, setDoc, updateDoc, serverTimestamp } = window.firebaseModules;
                const userRef = doc(db, `artifacts/${APP_ID}/users/${currentUserId}`);
                const userDoc = await getDoc(userRef);
                
                const userData = userDoc.exists() ? userDoc.data() : {};
                const credits = userData.credits ?? 0;
                
                let updateData = {
                    lastGenerationDate: serverTimestamp(),
                };
                
                // Increment total generations
                const currentTotal = userData.totalGenerations || 0;
                updateData.totalGenerations = currentTotal + 1;
                
                // Deduct credit (no free generations)
                if (credits > 0) {
                    updateData.credits = credits - 1;
                } else {
                    // Should not happen if checkUsageLimit worked correctly
                    throw new Error('No credits available');
                }
                
                console.log('incrementUsage: Updating with data', updateData);
                
                if (userDoc.exists()) {
                    await updateDoc(userRef, updateData);
                    console.log('incrementUsage: Updated existing document');
                } else {
                    await setDoc(userRef, {
                        ...updateData,
                        credits: updateData.credits ?? 0,
                        hasPaidOnce: false,
                        totalGenerations: 1,
                    });
                    console.log('incrementUsage: Created new document');
                }
                
                // Verify the update
                const verifyDoc = await getDoc(userRef);
                if (verifyDoc.exists()) {
                    console.log('incrementUsage: Verified update', verifyDoc.data());
                }
            } catch (error) {
                console.error('Error incrementing usage:', error);
                console.error('Error details:', {
                    message: error.message,
                    code: error.code,
                    stack: error.stack
                });
            }
        }
        
        async function resetDailyUsage() {
            if (!db || !currentUserId) return;
            
            const { doc, updateDoc, setDoc, getDoc } = window.firebaseModules;
            const userRef = doc(db, `artifacts/${APP_ID}/users/${currentUserId}`);
            
            // Check if document exists
            const userDoc = await getDoc(userRef);
            if (userDoc.exists()) {
                await updateDoc(userRef, { dailyGenerations: 0 });
            } else {
                // Create document if it doesn't exist
                await setDoc(userRef, { 
                    subscriptionStatus: 'free',
                    dailyGenerations: 0 
                });
            }
        }
        
        async function updateSubscriptionStatus(status, additionalData = {}) {
            if (!db || !currentUserId) return;
            
            const { doc, updateDoc, serverTimestamp } = window.firebaseModules;
            const userRef = doc(db, `artifacts/${APP_ID}/users/${currentUserId}`);
            
            const updates = {
                subscriptionStatus: status,
                ...additionalData
            };
            
            if (status === 'trial' && !additionalData.trialStartDate) {
                updates.trialStartDate = serverTimestamp();
            }
            
            await updateDoc(userRef, updates);
        }
        
        async function startTrial() {
            await updateSubscriptionStatus('trial');
        }
        
        function HighlightedText({ original, tailored, changes }) {
            if (!changes || (!changes.added?.length && !changes.modified?.length)) {
                // Fallback: simple text display
                return <p className="text-slate-700 leading-relaxed whitespace-pre-wrap text-sm">{tailored}</p>;
            }
            
            // Create highlighted version
            let highlightedText = tailored;
            const addedKeywords = changes.added || [];
            
            // Highlight added keywords/phrases
            addedKeywords.forEach(keyword => {
                const regex = new RegExp(`(${keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                highlightedText = highlightedText.replace(regex, '<mark class="bg-emerald-300 text-emerald-900 font-semibold px-1 rounded">$1</mark>');
            });
            
            return (
                <div 
                    className="text-slate-700 leading-relaxed whitespace-pre-wrap text-sm"
                    dangerouslySetInnerHTML={{ __html: highlightedText }}
                />
            );
        }
        
        function App() {
            const [jobDescription, setJobDescription] = useState('');
            const [resumeSection, setResumeSection] = useState('');
            const [resumeSectionType, setResumeSectionType] = useState('general');
            const [tailoredResume, setTailoredResume] = useState('');
            const [keywordMatches, setKeywordMatches] = useState(null);
            const [improvementTips, setImprovementTips] = useState([]);
            const [changes, setChanges] = useState(null);
            const [showComparison, setShowComparison] = useState(false);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [savedResumes, setSavedResumes] = useState([]);
            const [firebaseReady, setFirebaseReady] = useState(false);
            const [toast, setToast] = useState({ show: false, message: '', type: 'success' });
            
            // Subscription and auth state
            const [user, setUser] = useState(null);
            const [subscriptionData, setSubscriptionData] = useState(null);
            const [usageLimit, setUsageLimit] = useState({ canGenerate: true, remaining: 5, message: '' });
            const [showAuthModal, setShowAuthModal] = useState(false);
            const [showPricingModal, setShowPricingModal] = useState(false);
            const [showStats, setShowStats] = useState(false);
            const [userStats, setUserStats] = useState(null);
            const [statsLoading, setStatsLoading] = useState(false);
            const [authMode, setAuthMode] = useState('signin'); // 'signin' or 'signup'
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [authLoading, setAuthLoading] = useState(false);
            const [checkoutLoading, setCheckoutLoading] = useState(false);
            const [showLanding, setShowLanding] = useState(!user); // Show landing page when not logged in
            const [uploadedResume, setUploadedResume] = useState('');
            const [uploadedFileName, setUploadedFileName] = useState('');
            
            // Theme state - initialize from localStorage or default to light
            const [isDark, setIsDark] = useState(() => {
                const saved = localStorage.getItem('resumeforge_theme');
                return saved === 'dark';
            });
            const [showSavedResumes, setShowSavedResumes] = useState(false);
            
            // Ref to store resumes unsubscribe function for cleanup
            const resumesUnsubscribeRef = useRef(null);
            
            // Toggle theme function
            const toggleTheme = () => {
                const newTheme = !isDark;
                setIsDark(newTheme);
                localStorage.setItem('resumeforge_theme', newTheme ? 'dark' : 'light');
                trackEvent('theme_toggled', { theme: newTheme ? 'dark' : 'light' });
            };
            
            // Apply theme to document root
            useEffect(() => {
                if (isDark) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [isDark]);
            
            function showToast(message, type = 'success') {
                setToast({ show: true, message, type });
                setTimeout(() => {
                    setToast({ show: false, message: '', type: 'success' });
                }, 3000);
            }
            
            // Service Worker Registration for PWA
            useEffect(() => {
                if ('serviceWorker' in navigator) {
                    window.addEventListener('load', () => {
                        navigator.serviceWorker.register('/sw.js?v=1.3')
                            .then((registration) => {
                                console.log('Service Worker registered:', registration.scope);
                                
                                // Force update to clear old cache
                                registration.update();
                                
                                // Check for updates
                                registration.addEventListener('updatefound', () => {
                                    const newWorker = registration.installing;
                                    newWorker.addEventListener('statechange', () => {
                                        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                            // New service worker available - force reload
                                            showToast('New version available! Refreshing...', 'info');
                                            setTimeout(() => {
                                                window.location.reload();
                                            }, 1000);
                                        }
                                    });
                                });
                            })
                            .catch((error) => {
                                console.error('Service Worker registration failed:', error);
                            });
                    });
                }
            }, []);
            
            // Performance Monitoring
            useEffect(() => {
                if ('performance' in window && 'PerformanceObserver' in window) {
                    // Monitor Largest Contentful Paint (LCP)
                    try {
                        const observer = new PerformanceObserver((list) => {
                            const entries = list.getEntries();
                            const lastEntry = entries[entries.length - 1];
                            console.log('LCP:', lastEntry.renderTime || lastEntry.loadTime);
                            
                            // Log to analytics if LCP is slow (>2.5s)
                            if (lastEntry.renderTime > 2500 || lastEntry.loadTime > 2500) {
                                console.warn('Slow LCP detected:', lastEntry.renderTime || lastEntry.loadTime);
                            }
                        });
                        observer.observe({ entryTypes: ['largest-contentful-paint'] });
                    } catch (e) {
                        console.log('LCP monitoring not supported');
                    }
                    
                    // Monitor First Input Delay (FID)
                    try {
                        const fidObserver = new PerformanceObserver((list) => {
                            const entries = list.getEntries();
                            entries.forEach((entry) => {
                                if (entry.processingStart - entry.startTime > 100) {
                                    console.warn('Slow FID detected:', entry.processingStart - entry.startTime);
                                }
                            });
                        });
                        fidObserver.observe({ entryTypes: ['first-input'] });
                    } catch (e) {
                        console.log('FID monitoring not supported');
                    }
                }
            }, []);
            
            useEffect(() => {
                // Initialize Firebase
                if (!initializeFirebase()) return;
                
                const { onAuthStateChanged } = window.firebaseModules;
                
                const unsubscribeAuth = onAuthStateChanged(auth, async (firebaseUser) => {
                    // Clean up previous resumes listener if it exists
                    if (resumesUnsubscribeRef.current) {
                        resumesUnsubscribeRef.current();
                        resumesUnsubscribeRef.current = null;
                    }
                    
                    if (firebaseUser) {
                        // Check if user is anonymous - if so, sign them out immediately
                        // We only allow email/password authentication
                        if (firebaseUser.isAnonymous || !firebaseUser.email) {
                            // Anonymous user or user without email - sign them out
                            const { signOut } = window.firebaseModules;
                            try {
                                await signOut(auth);
                            } catch (error) {
                                console.error('Error signing out anonymous user:', error);
                            }
                            // The signOut will trigger onAuthStateChanged again with null user
                            // So we'll handle it in the else block below
                            return;
                        }
                        
                        // User has email (email/password auth) - allow them to stay signed in
                        currentUserId = firebaseUser.uid;
                        setUser(firebaseUser);
                        setFirebaseReady(true);
                        
                        // Load user subscription data with error handling
                        try {
                        const userData = await getUserSubscriptionData();
                        setSubscriptionData(userData);
                        
                        // Check usage limits
                        const limit = await checkUsageLimit();
                        setUsageLimit(limit);
                        } catch (error) {
                            console.error('Error loading subscription data:', error);
                            // Set default values on error
                            setSubscriptionData({
                                credits: 0,
                                hasPaidOnce: false,
                                freeGenerationUsed: false,
                            });
                            setUsageLimit({ 
                                canGenerate: false, 
                                remaining: 0, 
                                message: 'Unable to load credit balance. Please refresh the page.', 
                                isFree: false 
                            });
                            // Only show toast if it's not a permission error (likely from old cached code)
                            if (!error.code || (!error.code.includes('permission') && !error.message?.includes('permission'))) {
                                showToast('Failed to load credit balance. Please refresh the page.', 'error');
                            }
                        }
                        
                        // Load saved resumes and capture unsubscribe function
                        resumesUnsubscribeRef.current = loadSavedResumes();
                        
                        // Close auth modal if open
                        setShowAuthModal(false);
                        setShowLanding(false);
                    } else {
                        // No user - show landing page and reset state
                        setUser(null);
                        setSubscriptionData(null);
                        setUsageLimit({ canGenerate: false, remaining: 0, message: 'Please sign in to continue', isFree: false });
                        setShowAuthModal(false);
                        setShowLanding(true);
                        setFirebaseReady(true);
                        currentUserId = null;
                    }
                });
                
                // Cleanup function
                return () => {
                    unsubscribeAuth();
                    if (resumesUnsubscribeRef.current) {
                        resumesUnsubscribeRef.current();
                        resumesUnsubscribeRef.current = null;
                    }
                };
            }, []);
            
            useEffect(() => {
                // Refresh usage limit periodically
                if (firebaseReady && currentUserId) {
                    const interval = setInterval(async () => {
                        try {
                        const limit = await checkUsageLimit();
                        setUsageLimit(limit);
                        const userData = await getUserSubscriptionData();
                        setSubscriptionData(userData);
                        } catch (error) {
                            console.error('Error refreshing subscription data:', error);
                            // Don't show error toast on background refresh to avoid annoying users
                        }
                    }, 60000); // Check every minute
                    
                    return () => clearInterval(interval);
                }
            }, [firebaseReady, currentUserId]);
            
            // Analytics Tracking Helper
            const trackEvent = (eventName, eventData = {}) => {
                // Log to console in development
                if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                    console.log('Analytics Event:', eventName, eventData);
                }
                
                // Track with Firebase Analytics if available
                if (window.firebaseModules && window.firebaseModules.getAnalytics) {
                    try {
                        const { getAnalytics, logEvent } = window.firebaseModules;
                        const analytics = getAnalytics(app);
                        logEvent(analytics, eventName, eventData);
                    } catch (e) {
                        console.log('Analytics not available');
                    }
                }
            };
            
            // Keyboard shortcuts
            useEffect(() => {
                const handleKeyDown = (e) => {
                    // Ctrl/Cmd + Enter to tailor resume
                    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                        if (!loading && jobDescription.trim() && resumeSection.trim() && user) {
                            e.preventDefault();
                            trackEvent('keyboard_shortcut_tailor');
                            generateTailoredResume();
                        }
                    }
                    
                    // Escape to close modals
                    if (e.key === 'Escape') {
                        if (showAuthModal && user) {
                            setShowAuthModal(false);
                            setError('');
                            setEmail('');
                            setPassword('');
                        } else if (showPricingModal) {
                            setShowPricingModal(false);
                        }
                    }
                    
                    // Ctrl/Cmd + K to focus job description
                    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                        e.preventDefault();
                        const jobInput = document.querySelector('textarea[aria-label="Job description input"]');
                        if (jobInput) {
                            jobInput.focus();
                        }
                    }
                };

                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [loading, jobDescription, resumeSection, user, showAuthModal, showPricingModal]);
            
            function loadSavedResumes() {
                if (!db || !currentUserId || APP_ID === '__app_id') return null;
                
                const { collection, query, where, onSnapshot } = window.firebaseModules;
                const resumesRef = collection(db, `artifacts/${APP_ID}/users/${currentUserId}/saved_resumes`);
                
                const unsubscribe = onSnapshot(resumesRef, (snapshot) => {
                    const resumes = [];
                    snapshot.forEach((doc) => {
                        resumes.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    setSavedResumes(resumes);
                }, (error) => {
                    if (error.code === 'permission-denied' || error.message?.includes('permission')) {
                        console.warn('Permission denied loading saved resumes. Check Firestore security rules.');
                        console.warn('See FIRESTORE_RULES_FIX.md for instructions.');
                        // Set empty array so UI doesn't break
                        setSavedResumes([]);
                    } else {
                        console.error('Error loading saved resumes:', error);
                    }
                });
                
                return unsubscribe;
            }
            
            async function generateTailoredResume() {
                // Require authentication
                if (!user || !currentUserId) {
                    setError('Please sign in to tailor your resume');
                    setShowAuthModal(true);
                    trackEvent('resume_tailor_unauthorized');
                    return;
                }
                
                if (!jobDescription.trim()) {
                    setError('Please enter a job description');
                    return;
                }
                
                if (!resumeSection.trim()) {
                    setError('Please enter your resume section');
                    return;
                }
                
                // Check usage limits
                const limit = await checkUsageLimit();
                setUsageLimit(limit);
                
                if (!limit.canGenerate) {
                    setError(limit.message);
                    setShowPricingModal(true);
                    trackEvent('resume_tailor_insufficient_credits');
                    return;
                }
                
                const startTime = performance.now();
                setLoading(true);
                setError('');
                setTailoredResume('');
                setKeywordMatches(null);
                setImprovementTips([]);
                setChanges(null);
                setShowComparison(false);
                
                try {
                    // Call Firebase Cloud Function for resume tailoring
                    if (!functions) {
                        throw new Error('Firebase Functions not initialized. Please refresh the page.');
                    }
                    
                    const { httpsCallable } = window.firebaseModules;
                    const generateTailoredResumeFn = httpsCallable(functions, 'generateTailoredResume');
                    
                    const result = await generateTailoredResumeFn({ 
                        jobDescription: jobDescription.trim(),
                        resumeSection: resumeSection.trim(),
                        sectionType: resumeSectionType
                    });
                    
                    if (!result.data || !result.data.success) {
                        throw new Error(result.data?.error || 'Failed to tailor resume');
                    }
                    
                    // Set the tailored resume and analysis results
                    setTailoredResume(result.data.tailoredResume || '');
                    setKeywordMatches(result.data.keywordMatches || null);
                    setImprovementTips(result.data.improvementTips || []);
                    setChanges(result.data.changes || null);
                    setShowComparison(false); // Reset comparison view
                    
                    // Track successful generation
                    const generationTime = performance.now() - startTime;
                    trackEvent('resume_tailor_success', {
                        generationTime: Math.round(generationTime),
                        sectionType: resumeSectionType
                    });
                    
                    // Increment usage counter
                    await incrementUsage();
                    
                    // Refresh usage limit
                    const newLimit = await checkUsageLimit();
                    setUsageLimit(newLimit);
                    
                    // Refresh stats if stats modal is open
                    if (showStats) {
                        await fetchUserStats();
                    }
                } catch (err) {
                    const generationTime = performance.now() - startTime;
                    let errorMessage = `Error tailoring resume: ${err.message}`;
                    
                    if (err.message && err.message.includes('insufficient credits')) {
                        errorMessage = 'Insufficient credits. Please purchase more credits to continue.';
                    } else if (err.message && (err.message.includes('network') || err.message.includes('fetch'))) {
                        errorMessage = 'Network error. Please check your connection and try again.';
                    } else if (err.message && err.message.includes('timeout')) {
                        errorMessage = 'Request timed out. The AI service may be busy. Please try again.';
                    } else if (err.message && err.message.includes('permission')) {
                        errorMessage = 'Permission denied. Please check your account status.';
                    }
                    
                    setError(errorMessage);
                    
                    // Track error
                    trackEvent('resume_tailor_error', {
                        error: err.message,
                        generationTime: Math.round(generationTime)
                    });
                    
                    console.error('Resume tailoring error:', err);
                } finally {
                    setLoading(false);
                }
            }
            
            async function saveResume(resumeText, jobDescription, sectionType) {
                if (!db || !currentUserId || APP_ID === '__app_id') {
                    setError('Firebase not properly configured. Cannot save resume.');
                    return;
                }
                
                try {
                    const { collection, addDoc } = window.firebaseModules;
                    const resumesRef = collection(db, `artifacts/${APP_ID}/users/${currentUserId}/saved_resumes`);
                    
                    await addDoc(resumesRef, {
                        resume: resumeText,
                        createdAt: new Date().toISOString(),
                        jobDescription: jobDescription || '',
                        sectionType: sectionType || 'general'
                    });
                    
                    trackEvent('resume_saved', { sectionType: sectionType || 'general' });
                    showToast('Resume saved successfully!', 'success');
                } catch (err) {
                    const errorMessage = err.message || 'Unknown error occurred';
                    setError(`Error saving resume: ${errorMessage}`);
                    trackEvent('resume_save_error', { error: errorMessage });
                    console.error('Save error:', err);
                    
                    // Show user-friendly error message
                    if (err.code === 'permission-denied') {
                        showToast('Permission denied. Please check your account permissions.', 'error');
                    } else if (err.code === 'unavailable') {
                        showToast('Service unavailable. Please check your internet connection.', 'error');
                    } else {
                        showToast('Failed to save resume. Please try again.', 'error');
                    }
                }
            }
            
            function copyResume(resumeText) {
                navigator.clipboard.writeText(resumeText).then(() => {
                    trackEvent('resume_copied');
                    showToast('Resume copied to clipboard!', 'success');
                }).catch((err) => {
                    trackEvent('resume_copy_error', { error: err.message });
                    setError(`Error copying resume: ${err.message}`);
                });
            }
            
            async function deleteResume(resumeId) {
                if (!db || !currentUserId || APP_ID === '__app_id') {
                    setError('Firebase not properly configured. Cannot delete resume.');
                    return;
                }
                
                try {
                    const { doc, deleteDoc } = window.firebaseModules;
                    const resumeRef = doc(db, `artifacts/${APP_ID}/users/${currentUserId}/saved_resumes/${resumeId}`);
                    await deleteDoc(resumeRef);
                } catch (err) {
                    setError(`Error deleting resume: ${err.message}`);
                    console.error('Delete error:', err);
                }
            }
            
            async function handleSignUp() {
                if (!email || !password) {
                    setError('Please enter email and password');
                    return;
                }
                
                setAuthLoading(true);
                const result = await signUpWithEmail(email, password);
                setAuthLoading(false);
                
                if (result.success) {
                    trackEvent('user_signup_success');
                    showToast('Account created successfully!', 'success');
                    setShowAuthModal(false);
                        setShowLanding(false);
                    setEmail('');
                    setPassword('');
                    
                    // Initialize user data
                    try {
                    const userData = await getUserSubscriptionData();
                    setSubscriptionData(userData);
                    const limit = await checkUsageLimit();
                    setUsageLimit(limit);
                    } catch (error) {
                        console.error('Error loading subscription data after sign up:', error);
                        
                        // Check if it's a permission error - might be from old cached code
                        if (error.code === 'permission-denied' || error.message?.includes('permission')) {
                            console.warn('Firestore permission error. This may be due to cached code. Try hard refresh (Cmd+Shift+R).');
                            // Don't show error for permission errors - likely from old cached code
                        } else {
                            showToast('Failed to load credit balance. Please refresh the page.', 'error');
                        }
                        
                        // Set default values on error
                        setSubscriptionData({
                            credits: 0,
                            hasPaidOnce: false,
                        });
                        setUsageLimit({ 
                            canGenerate: false, 
                            remaining: 0, 
                            message: 'No credits available. Please purchase credits.', 
                            isFree: false 
                        });
                    }
                } else {
                    trackEvent('user_signup_error', { error: result.error });
                    setError(result.error);
                }
            }
            
            async function handleSignIn() {
                if (!email || !password) {
                    setError('Please enter email and password');
                    return;
                }
                
                setAuthLoading(true);
                const result = await signInWithEmail(email, password);
                setAuthLoading(false);
                
                if (result.success) {
                    trackEvent('user_signin_success');
                    showToast('Signed in successfully!', 'success');
                    setShowAuthModal(false);
                    setEmail('');
                    setPassword('');
                    setShowLanding(false);
                    
                    try {
                    const userData = await getUserSubscriptionData();
                    setSubscriptionData(userData);
                    const limit = await checkUsageLimit();
                    setUsageLimit(limit);
                    } catch (error) {
                        console.error('Error loading subscription data after sign in:', error);
                        
                        // Check if it's a permission error - might be from old cached code
                        if (error.code === 'permission-denied' || error.message?.includes('permission')) {
                            console.warn('Firestore permission error. This may be due to cached code. Try hard refresh (Cmd+Shift+R).');
                            // Don't show error for permission errors - likely from old cached code
                        } else {
                            showToast('Failed to load credit balance. Please refresh the page.', 'error');
                        }
                        
                        // Set default values on error
                        setSubscriptionData({
                            credits: 0,
                            hasPaidOnce: false,
                        });
                        setUsageLimit({ 
                            canGenerate: false, 
                            remaining: 0, 
                            message: 'Unable to load credit balance', 
                            isFree: false 
                        });
                    }
                } else {
                    trackEvent('user_signin_error', { error: result.error });
                    setError(result.error);
                }
            }
            
            async function handleSignOut() {
                const result = await signOutUser();
                if (result.success) {
                    setUser(null);
                    setSubscriptionData(null);
                    setUsageLimit({ canGenerate: false, remaining: 0, message: 'Please sign in to continue', isFree: false });
                    setShowAuthModal(true); // Show auth modal after sign out
                    setShowStats(false);
                    setUserStats(null);
                    showToast('Signed out successfully', 'success');
                }
            }
            
            async function fetchUserStats() {
                if (!db || !currentUserId) {
                    console.log('fetchUserStats: db or currentUserId not available', { db: !!db, currentUserId });
                    return;
                }
                
                setStatsLoading(true);
                try {
                    const { doc, getDoc, collection, getDocs } = window.firebaseModules;
                    
                    // Get user document - ensure path has even number of segments
                    // Path: artifacts/{appId}/users/{userId} = 4 segments (even, correct)
                    const userRef = doc(db, `artifacts/${APP_ID}/users/${currentUserId}`);
                    const userSnap = await getDoc(userRef);
                    
                    console.log('fetchUserStats: User document exists?', userSnap.exists());
                    if (userSnap.exists()) {
                        console.log('fetchUserStats: User data', userSnap.data());
                    }
                    
                    // Get saved resumes count
                    const resumesRef = collection(db, `artifacts/${APP_ID}/users/${currentUserId}/saved_resumes`);
                    const resumesSnap = await getDocs(resumesRef);
                    
                    console.log('fetchUserStats: Saved resumes count', resumesSnap.size);
                    
                    const userData = userSnap.exists() ? userSnap.data() : {};
                    
                    // Calculate credits used (total - remaining)
                    const totalGens = userData.totalGenerations || 0;
                    const remainingCredits = userData.credits || 0;
                    const creditsUsed = Math.max(0, totalGens - remainingCredits);
                    
                    // Format dates safely
                    let accountCreated = 'N/A';
                    if (userData.createdAt) {
                        try {
                            if (userData.createdAt.toMillis) {
                                accountCreated = new Date(userData.createdAt.toMillis()).toLocaleDateString();
                            } else if (userData.createdAt.seconds) {
                                accountCreated = new Date(userData.createdAt.seconds * 1000).toLocaleDateString();
                            }
                        } catch (e) {
                            accountCreated = 'N/A';
                        }
                    }
                    
                    let lastGeneration = 'Never';
                    if (userData.lastGenerationDate) {
                        try {
                            if (userData.lastGenerationDate.toMillis) {
                                lastGeneration = new Date(userData.lastGenerationDate.toMillis()).toLocaleDateString();
                            } else if (userData.lastGenerationDate.seconds) {
                                lastGeneration = new Date(userData.lastGenerationDate.seconds * 1000).toLocaleDateString();
                            }
                        } catch (e) {
                            lastGeneration = 'Never';
                        }
                    }
                    
                    const stats = {
                        totalGenerations: totalGens,
                        savedResumes: resumesSnap.size,
                        creditsUsed: creditsUsed,
                        creditsRemaining: remainingCredits,
                        hasPaidOnce: userData.hasPaidOnce || false,
                        accountCreated: accountCreated,
                        lastGeneration: lastGeneration
                    };
                    
                    console.log('fetchUserStats: Final stats object', stats);
                    setUserStats(stats);
                } catch (error) {
                    console.error('Error fetching stats:', error);
                    console.error('Error details:', {
                        message: error.message,
                        code: error.code,
                        stack: error.stack
                    });
                    setError('Failed to load statistics: ' + error.message);
                } finally {
                    setStatsLoading(false);
                }
            }
            
            useEffect(() => {
                if (showStats && user) {
                    fetchUserStats();
                }
            }, [showStats, user]);
            
            async function handleStripeCheckout() {
                // Prevent multiple simultaneous calls
                if (checkoutLoading) {
                    return;
                }
                
                if (!user || !currentUserId) {
                    setShowAuthModal(true);
                    showToast('Please sign up or sign in to subscribe', 'error');
                    return;
                }
                
                if (STRIPE_PUBLISHABLE_KEY === '__stripe_publishable_key' || STRIPE_PRICE_ID === '__stripe_price_id') {
                    showToast('Stripe not configured. Please add your Stripe keys.', 'error');
                    return;
                }
                
                if (!functions) {
                    showToast('Firebase Functions not initialized. Please refresh the page.', 'error');
                    return;
                }
                
                setCheckoutLoading(true);
                
                try {
                    trackEvent('checkout_initiated');
                    const { httpsCallable } = window.firebaseModules;
                    const createCheckoutSession = httpsCallable(functions, 'createCheckoutSession');
                    
                    // Get current URL for success/cancel redirects
                    const currentUrl = window.location.origin + window.location.pathname;
                    
                    // Call Firebase Cloud Function
                    const result = await createCheckoutSession({
                        priceId: STRIPE_PRICE_ID,
                        email: user.email,
                        successUrl: currentUrl + '?subscription=success',
                        cancelUrl: currentUrl + '?subscription=canceled'
                    });
                    
                    // Use modern Stripe Checkout redirect with session URL
                    const { url, sessionId } = result.data;
                    
                    if (url) {
                        // Modern approach: redirect directly using session URL
                        // Don't reset loading state here since we're redirecting
                        window.location.href = url;
                    } else if (sessionId) {
                        // Fallback to deprecated redirectToCheckout for backward compatibility
                        const stripe = Stripe(STRIPE_PUBLISHABLE_KEY);
                        const checkoutResult = await stripe.redirectToCheckout({
                            sessionId: sessionId
                        });
                        
                        if (checkoutResult.error) {
                            setCheckoutLoading(false);
                            showToast(checkoutResult.error.message, 'error');
                        }
                        // If successful, redirect will happen, so don't reset loading
                    } else {
                        throw new Error('No checkout URL or session ID returned');
                    }
                } catch (error) {
                    console.error('Stripe checkout error:', error);
                    setCheckoutLoading(false);
                    trackEvent('checkout_error', { error: error.message });
                    showToast(error.message || 'Failed to create checkout session. Please try again.', 'error');
                }
            }
            
            function exportToPDF(resumeText) {
                // Simple PDF export using browser print
                const printWindow = window.open('', '_blank');
                
                // Check if popup was blocked
                if (!printWindow) {
                    showToast('Popup blocked. Please allow popups for this site to export PDFs.', 'error');
                    return;
                }
                
                printWindow.document.write(`
                    <html>
                        <head>
                            <title>Tailored Resume</title>
                            <style>
                                body { font-family: Arial, sans-serif; padding: 40px; line-height: 1.6; }
                                h1 { color: #333; }
                            </style>
                        </head>
                        <body>
                            <h1>Tailored Resume</h1>
                            <p>${resumeText.replace(/\n/g, '<br>')}</p>
                        </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
            }
            
            function exportToWord(resumeText) {
                const content = `
                    <html>
                        <head>
                            <meta charset="utf-8">
                            <title>Tailored Resume</title>
                        </head>
                        <body>
                            <h1>Tailored Resume</h1>
                            <p>${resumeText.replace(/\n/g, '<br>')}</p>
                        </body>
                    </html>
                `;
                
                const blob = new Blob(['\ufeff', content], { type: 'application/msword' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'tailored-resume.doc';
                link.click();
                URL.revokeObjectURL(url);
            }
            
            async function handleResumeUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'text/plain'];
                if (!allowedTypes.includes(file.type)) {
                    showToast('Please upload a PDF, DOC, DOCX, or TXT file', 'error');
                    return;
                }
                
                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    showToast('File size must be less than 5MB', 'error');
                    return;
                }
                
                setUploadedFileName(file.name);
                setLoading(true);
                
                try {
                    // Handle different file types
                    if (file.type === 'text/plain') {
                        // Plain text file
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const text = e.target.result;
                            setResumeSection(text);
                            setUploadedResume(text);
                            showToast('Resume uploaded successfully!', 'success');
                            setLoading(false);
                        };
                        reader.readAsText(file);
                    } else if (file.type === 'application/pdf') {
                        // PDF file - use pdf.js
                        if (typeof pdfjsLib === 'undefined') {
                            showToast('PDF library not loaded. Please refresh the page.', 'error');
                            setLoading(false);
                            return;
                        }
                        
                        const arrayBuffer = await file.arrayBuffer();
                        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                        let fullText = '';
                        
                        // Extract text from all pages
                        for (let i = 1; i <= pdf.numPages; i++) {
                            const page = await pdf.getPage(i);
                            const textContent = await page.getTextContent();
                            const pageText = textContent.items.map(item => item.str).join(' ');
                            fullText += pageText + '\n';
                        }
                        
                        setResumeSection(fullText.trim());
                        setUploadedResume(fullText.trim());
                        showToast('PDF uploaded and parsed successfully!', 'success');
                        setLoading(false);
                    } else if (file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
                        // DOCX file - use mammoth.js
                        if (typeof mammoth === 'undefined') {
                            showToast('DOCX library not loaded. Please refresh the page.', 'error');
                            setLoading(false);
                            return;
                        }
                        
                        const arrayBuffer = await file.arrayBuffer();
                        const result = await mammoth.extractRawText({ arrayBuffer: arrayBuffer });
                        const text = result.value;
                        
                        setResumeSection(text);
                        setUploadedResume(text);
                        showToast('DOCX uploaded and parsed successfully!', 'success');
                        setLoading(false);
                    } else if (file.type === 'application/msword') {
                        // Old DOC format - not easily parseable in browser
                        showToast('Old DOC format (.doc) is not supported. Please convert to DOCX or PDF, or paste the text manually.', 'error');
                        setLoading(false);
                    }
                } catch (error) {
                    console.error('Error reading file:', error);
                    showToast(`Error reading file: ${error.message}. Please try again or paste the text manually.`, 'error');
                    setLoading(false);
                }
            }
            
            const credits = subscriptionData?.credits || 0;
            const hasPaidOnce = subscriptionData?.hasPaidOnce || false;
            
            return (
                <div className={`min-h-screen py-12 px-4 transition-colors duration-200 ${
                    isDark 
                        ? 'bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900' 
                        : 'bg-gradient-to-br from-slate-50 via-white to-slate-50'
                }`}>
                    {/* Skip to main content link for accessibility */}
                    <a href="#main-content" className="skip-link">
                        Skip to main content
                    </a>
                    
                    {/* Toast Notification */}
                    {toast.show && (
                        <div className={`fixed top-4 right-4 z-50 px-6 py-4 rounded-xl shadow-lg animate-fade-in ${
                            toast.type === 'success' ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white'
                        }`}>
                            <div className="flex items-center gap-2">
                                {toast.type === 'success' ? (
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                    </svg>
                                ) : (
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                )}
                                <span className="font-semibold">{toast.message}</span>
                            </div>
                        </div>
                    )}
                    
                    {/* Landing Page - Full Screen */}
                    {!user && showLanding ? (
                        <div className="min-h-screen flex flex-col items-center justify-center px-4 py-12">
                            <div className="max-w-5xl w-full">
                                {/* Hero Section */}
                                <div className="text-center mb-20">
                                    <div className={`inline-block px-4 py-2 rounded-full text-sm font-semibold mb-6 ${
                                        isDark 
                                            ? 'bg-violet-900/30 text-violet-300 border border-violet-700' 
                                            : 'bg-violet-100 text-violet-700 border border-violet-200'
                                    }`}>
                                        ✨ AI-Powered Resume Optimization
                                    </div>
                                    <h1 className={`text-6xl md:text-7xl font-bold mb-6 bg-gradient-to-r ${
                                        isDark 
                                            ? 'from-white to-slate-300 bg-clip-text text-transparent' 
                                            : 'from-slate-900 to-violet-600 bg-clip-text text-transparent'
                                    }`}>
                                        Land More Interviews
                                    </h1>
                                    <p className={`text-3xl md:text-4xl font-semibold mb-4 ${
                                        isDark ? 'text-slate-200' : 'text-slate-800'
                                    }`}>
                                        Tailor Your Resume to Every Job
                                    </p>
                                    <p className={`text-lg md:text-xl max-w-3xl mx-auto mb-10 leading-relaxed ${
                                        isDark ? 'text-slate-400' : 'text-slate-600'
                                    }`}>
                                        Stop sending generic resumes. Our AI analyzes job descriptions and tailors your resume with the right keywords, improving your ATS score and getting you past the screening process.
                                    </p>
                                    <div className="flex flex-col sm:flex-row gap-4 justify-center items-center mb-8">
                                        <button
                                            onClick={() => {
                                                setShowAuthModal(true);
                                                setAuthMode('signup');
                                                trackEvent('landing_signup_clicked');
                                            }}
                                            className="px-10 py-5 text-lg font-semibold text-white bg-gradient-to-r from-violet-600 to-purple-600 hover:from-violet-700 hover:to-purple-700 rounded-xl transition-all duration-300 shadow-xl hover:shadow-2xl transform hover:scale-105"
                                        >
                                            Start Tailoring Now →
                                        </button>
                                        <button
                                            onClick={() => {
                                                setShowAuthModal(true);
                                                setAuthMode('signin');
                                                trackEvent('landing_signin_clicked');
                                            }}
                                            className={`px-10 py-5 text-lg font-semibold rounded-xl transition-all duration-300 ${
                                                isDark 
                                                    ? 'bg-slate-700 text-white hover:bg-slate-600 border border-slate-600' 
                                                    : 'bg-white text-violet-600 hover:bg-violet-50 border-2 border-violet-600 shadow-md'
                                            }`}
                                        >
                                            Sign In
                                        </button>
                                    </div>
                                    <div className="flex flex-wrap justify-center gap-6 text-sm">
                                        <div className={`flex items-center gap-2 ${
                                            isDark ? 'text-slate-400' : 'text-slate-600'
                                        }`}>
                                            <svg className="w-5 h-5 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                            </svg>
                                            No credit card required
                                        </div>
                                        <div className={`flex items-center gap-2 ${
                                            isDark ? 'text-slate-400' : 'text-slate-600'
                                        }`}>
                                            <svg className="w-5 h-5 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                            </svg>
                                            Instant results
                                        </div>
                                        <div className={`flex items-center gap-2 ${
                                            isDark ? 'text-slate-400' : 'text-slate-600'
                                        }`}>
                                            <svg className="w-5 h-5 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                            </svg>
                                            Secure & private
                                        </div>
                                    </div>
                                </div>

                                {/* Problem/Solution Section */}
                                <div className={`rounded-3xl p-8 md:p-12 mb-16 ${
                                    isDark 
                                        ? 'bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700' 
                                        : 'bg-gradient-to-br from-slate-50 to-white border border-slate-200'
                                }`}>
                                    <div className="grid md:grid-cols-2 gap-8 items-center">
                                        <div>
                                            <h2 className={`text-3xl font-bold mb-4 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>
                                                Tired of Getting Rejected?
                                            </h2>
                                            <p className={`text-lg mb-6 ${
                                                isDark ? 'text-slate-300' : 'text-slate-600'
                                            }`}>
                                                Most resumes never make it past ATS systems because they lack the right keywords. You're qualified, but your resume isn't getting through.
                                            </p>
                                            <ul className={`space-y-3 ${
                                                isDark ? 'text-slate-400' : 'text-slate-600'
                                            }`}>
                                                <li className="flex items-start gap-3">
                                                    <span className="text-red-500 mt-1">✗</span>
                                                    <span>Generic resumes that don't match job descriptions</span>
                                                </li>
                                                <li className="flex items-start gap-3">
                                                    <span className="text-red-500 mt-1">✗</span>
                                                    <span>Missing keywords that ATS systems look for</span>
                                                </li>
                                                <li className="flex items-start gap-3">
                                                    <span className="text-red-500 mt-1">✗</span>
                                                    <span>Hours spent manually tailoring each application</span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div>
                                            <h2 className={`text-3xl font-bold mb-4 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>
                                                Get Past ATS, Land Interviews
                                            </h2>
                                            <p className={`text-lg mb-6 ${
                                                isDark ? 'text-slate-300' : 'text-slate-600'
                                            }`}>
                                                ResumeForge uses AI to analyze job descriptions and automatically tailor your resume with the right keywords and phrasing.
                                            </p>
                                            <ul className={`space-y-3 ${
                                                isDark ? 'text-slate-400' : 'text-slate-600'
                                            }`}>
                                                <li className="flex items-start gap-3">
                                                    <span className="text-emerald-500 mt-1">✓</span>
                                                    <span>AI-powered keyword matching for ATS optimization</span>
                                                </li>
                                                <li className="flex items-start gap-3">
                                                    <span className="text-emerald-500 mt-1">✓</span>
                                                    <span>Detailed improvement tips and keyword analysis</span>
                                                </li>
                                                <li className="flex items-start gap-3">
                                                    <span className="text-emerald-500 mt-1">✓</span>
                                                    <span>Tailor your resume in seconds, not hours</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                {/* How It Works Section */}
                                <div className="mb-16">
                                    <h2 className={`text-4xl font-bold text-center mb-12 ${
                                        isDark ? 'text-white' : 'text-slate-900'
                                    }`}>
                                        How It Works
                                    </h2>
                                    <div className="grid md:grid-cols-4 gap-6">
                                        <div className="text-center">
                                            <div className={`w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-4 ${
                                                isDark 
                                                    ? 'bg-violet-600 text-white' 
                                                    : 'bg-violet-100 text-violet-600'
                                            }`}>
                                                1
                                            </div>
                                            <h3 className={`text-lg font-bold mb-2 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>Upload Resume</h3>
                                            <p className={isDark ? 'text-slate-400' : 'text-slate-600'}>
                                                Upload your resume (PDF, DOCX, or paste text)
                                            </p>
                                        </div>
                                        <div className="text-center">
                                            <div className={`w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-4 ${
                                                isDark 
                                                    ? 'bg-violet-600 text-white' 
                                                    : 'bg-violet-100 text-violet-600'
                                            }`}>
                                                2
                                            </div>
                                            <h3 className={`text-lg font-bold mb-2 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>Paste Job Description</h3>
                                            <p className={isDark ? 'text-slate-400' : 'text-slate-600'}>
                                                Copy and paste the job description you're applying for
                                            </p>
                                        </div>
                                        <div className="text-center">
                                            <div className={`w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-4 ${
                                                isDark 
                                                    ? 'bg-violet-600 text-white' 
                                                    : 'bg-violet-100 text-violet-600'
                                            }`}>
                                                3
                                            </div>
                                            <h3 className={`text-lg font-bold mb-2 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>AI Tailors Resume</h3>
                                            <p className={isDark ? 'text-slate-400' : 'text-slate-600'}>
                                                Our AI analyzes and tailors your resume with keywords
                                            </p>
                                        </div>
                                        <div className="text-center">
                                            <div className={`w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-4 ${
                                                isDark 
                                                    ? 'bg-violet-600 text-white' 
                                                    : 'bg-violet-100 text-violet-600'
                                            }`}>
                                                4
                                            </div>
                                            <h3 className={`text-lg font-bold mb-2 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>Get Results</h3>
                                            <p className={isDark ? 'text-slate-400' : 'text-slate-600'}>
                                                Receive tailored resume, keyword analysis, and tips
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {/* Features Grid */}
                                <div className="mb-16">
                                    <h2 className={`text-4xl font-bold text-center mb-12 ${
                                        isDark ? 'text-white' : 'text-slate-900'
                                    }`}>
                                        Why Choose ResumeForge?
                                    </h2>
                                    <div className="grid md:grid-cols-3 gap-6">
                                        <div className={`p-8 rounded-2xl transition-all duration-300 hover:scale-105 ${
                                            isDark 
                                                ? 'bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700 hover:border-violet-600' 
                                                : 'bg-white border border-slate-200 shadow-md hover:shadow-xl'
                                        }`}>
                                            <div className="text-5xl mb-4">🎯</div>
                                            <h3 className={`text-xl font-bold mb-3 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>ATS Optimization</h3>
                                            <p className={isDark ? 'text-slate-300' : 'text-slate-600'}>
                                                Match keywords from job descriptions to improve your resume's ATS compatibility and get past automated screening
                                            </p>
                                        </div>
                                        <div className={`p-8 rounded-2xl transition-all duration-300 hover:scale-105 ${
                                            isDark 
                                                ? 'bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700 hover:border-violet-600' 
                                                : 'bg-white border border-slate-200 shadow-md hover:shadow-xl'
                                        }`}>
                                            <div className="text-5xl mb-4">🤖</div>
                                            <h3 className={`text-xl font-bold mb-3 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>AI-Powered Analysis</h3>
                                            <p className={isDark ? 'text-slate-300' : 'text-slate-600'}>
                                                Advanced AI analyzes your resume and job description to provide tailored improvements and keyword suggestions
                                            </p>
                                        </div>
                                        <div className={`p-8 rounded-2xl transition-all duration-300 hover:scale-105 ${
                                            isDark 
                                                ? 'bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700 hover:border-violet-600' 
                                                : 'bg-white border border-slate-200 shadow-md hover:shadow-xl'
                                        }`}>
                                            <div className="text-5xl mb-4">⚡</div>
                                            <h3 className={`text-xl font-bold mb-3 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>Instant Results</h3>
                                            <p className={isDark ? 'text-slate-300' : 'text-slate-600'}>
                                                Get tailored resumes, keyword analysis, improvement tips, and comparison views in seconds
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {/* Pricing Section */}
                                <div className={`rounded-3xl p-8 md:p-12 text-center mb-16 ${
                                    isDark 
                                        ? 'bg-gradient-to-br from-violet-900/20 to-purple-900/20 border-2 border-violet-700' 
                                        : 'bg-gradient-to-br from-violet-50 to-purple-50 border-2 border-violet-200'
                                }`}>
                                    <h2 className={`text-4xl font-bold mb-2 ${
                                        isDark ? 'text-white' : 'text-slate-900'
                                    }`}>
                                        Simple, Affordable Pricing
                                    </h2>
                                    <p className={`text-lg mb-8 ${
                                        isDark ? 'text-slate-400' : 'text-slate-600'
                                    }`}>
                                        No subscriptions. Pay only for what you use.
                                    </p>
                                    <div className="flex items-baseline justify-center gap-2 mb-4">
                                        <div className={`text-6xl font-bold ${
                                            isDark ? 'text-white' : 'text-slate-900'
                                        }`}>
                                            $1.00
                                        </div>
                                        <div className={`text-2xl ${
                                            isDark ? 'text-slate-400' : 'text-slate-600'
                                        }`}>
                                            for 5 credits
                                        </div>
                                    </div>
                                    <p className={`text-sm mb-8 ${
                                        isDark ? 'text-slate-500' : 'text-slate-500'
                                    }`}>
                                        That's just $0.20 per tailored resume
                                    </p>
                                    <div className="grid md:grid-cols-3 gap-4 mb-8 max-w-3xl mx-auto">
                                        <div className={`p-5 rounded-xl ${
                                            isDark ? 'bg-slate-800 border border-slate-700' : 'bg-white border border-slate-200 shadow-sm'
                                        }`}>
                                            <div className={`text-2xl font-bold mb-1 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>5 Credits</div>
                                            <div className={`text-sm ${
                                                isDark ? 'text-slate-400' : 'text-slate-600'
                                            }`}>Only $1.00</div>
                                        </div>
                                        <div className={`p-5 rounded-xl ${
                                            isDark ? 'bg-slate-800 border border-slate-700' : 'bg-white border border-slate-200 shadow-sm'
                                        }`}>
                                            <div className={`text-2xl font-bold mb-1 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>PDF & DOCX</div>
                                            <div className={`text-sm ${
                                                isDark ? 'text-slate-400' : 'text-slate-600'
                                            }`}>File Upload</div>
                                        </div>
                                        <div className={`p-5 rounded-xl ${
                                            isDark ? 'bg-slate-800 border border-slate-700' : 'bg-white border border-slate-200 shadow-sm'
                                        }`}>
                                            <div className={`text-2xl font-bold mb-1 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>Instant</div>
                                            <div className={`text-sm ${
                                                isDark ? 'text-slate-400' : 'text-slate-600'
                                            }`}>Results</div>
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => {
                                            setShowAuthModal(true);
                                            setAuthMode('signup');
                                            trackEvent('landing_pricing_signup_clicked');
                                        }}
                                        className="px-10 py-5 text-lg font-semibold text-white bg-gradient-to-r from-violet-600 to-purple-600 hover:from-violet-700 hover:to-purple-700 rounded-xl transition-all duration-300 shadow-xl hover:shadow-2xl transform hover:scale-105 mb-4"
                                    >
                                        Get Started Now →
                                    </button>
                                    <p className={`text-sm ${
                                        isDark ? 'text-slate-500' : 'text-slate-500'
                                    }`}>
                                        Secure payment via Stripe • No hidden fees
                                    </p>
                                </div>

                                {/* FAQ Section */}
                                <div className="mb-16">
                                    <h2 className={`text-4xl font-bold text-center mb-12 ${
                                        isDark ? 'text-white' : 'text-slate-900'
                                    }`}>
                                        Frequently Asked Questions
                                    </h2>
                                    <div className="grid md:grid-cols-2 gap-6 max-w-4xl mx-auto">
                                        <div className={`p-6 rounded-xl ${
                                            isDark ? 'bg-slate-800 border border-slate-700' : 'bg-white border border-slate-200'
                                        }`}>
                                            <h3 className={`text-lg font-bold mb-2 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>How does it work?</h3>
                                            <p className={isDark ? 'text-slate-300' : 'text-slate-600'}>
                                                Simply upload your resume and paste the job description. Our AI analyzes both and provides a tailored version with optimized keywords.
                                            </p>
                                        </div>
                                        <div className={`p-6 rounded-xl ${
                                            isDark ? 'bg-slate-800 border border-slate-700' : 'bg-white border border-slate-200'
                                        }`}>
                                            <h3 className={`text-lg font-bold mb-2 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>Is my data secure?</h3>
                                            <p className={isDark ? 'text-slate-300' : 'text-slate-600'}>
                                                Yes! All data is encrypted and stored securely. We never share your information with third parties.
                                            </p>
                                        </div>
                                        <div className={`p-6 rounded-xl ${
                                            isDark ? 'bg-slate-800 border border-slate-700' : 'bg-white border border-slate-200'
                                        }`}>
                                            <h3 className={`text-lg font-bold mb-2 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>What file formats are supported?</h3>
                                            <p className={isDark ? 'text-slate-300' : 'text-slate-600'}>
                                                We support PDF, DOCX, and plain text files. You can also paste your resume text directly.
                                            </p>
                                        </div>
                                        <div className={`p-6 rounded-xl ${
                                            isDark ? 'bg-slate-800 border border-slate-700' : 'bg-white border border-slate-200'
                                        }`}>
                                            <h3 className={`text-lg font-bold mb-2 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>How many credits do I need?</h3>
                                            <p className={isDark ? 'text-slate-300' : 'text-slate-600'}>
                                                Each resume tailoring uses 1 credit. With 5 credits for $1.00, you can tailor 5 different resumes.
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {/* Final CTA Section */}
                                <div className={`rounded-3xl p-12 text-center ${
                                    isDark 
                                        ? 'bg-gradient-to-r from-violet-900/30 to-purple-900/30 border-2 border-violet-700' 
                                        : 'bg-gradient-to-r from-violet-100 to-purple-100 border-2 border-violet-300'
                                }`}>
                                    <h2 className={`text-4xl font-bold mb-4 ${
                                        isDark ? 'text-white' : 'text-slate-900'
                                    }`}>
                                        Ready to Land Your Dream Job?
                                    </h2>
                                    <p className={`text-xl mb-8 max-w-2xl mx-auto ${
                                        isDark ? 'text-slate-300' : 'text-slate-600'
                                    }`}>
                                        Join thousands of job seekers who are getting more interviews with AI-optimized resumes.
                                    </p>
                                    <button
                                        onClick={() => {
                                            setShowAuthModal(true);
                                            setAuthMode('signup');
                                            trackEvent('landing_final_cta_clicked');
                                        }}
                                        className="px-12 py-5 text-xl font-semibold text-white bg-gradient-to-r from-violet-600 to-purple-600 hover:from-violet-700 hover:to-purple-700 rounded-xl transition-all duration-300 shadow-xl hover:shadow-2xl transform hover:scale-105"
                                    >
                                        Start Tailoring Your Resume →
                                    </button>
                                </div>
                            </div>
                        </div>
                    ) : (
                        /* Main App Content - Only show when logged in */
                        <div id="main-content" className="max-w-6xl mx-auto animate-fade-in">
                        {/* Header with Account Info */}
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h1 className={`text-5xl font-bold mb-2 tracking-tight ${
                                    isDark ? 'text-white' : 'text-slate-900'
                                }`}>
                                    ResumeForge
                                </h1>
                                <p className={`text-lg font-light ${
                                    isDark ? 'text-slate-300' : 'text-slate-600'
                                }`}>
                                    Optimize your resume for ATS keyword alignment
                                </p>
                            </div>
                            <div className="flex items-center gap-2">
                                {user ? (
                                    <>
                                        <div className="flex items-center gap-2 px-2 py-1.5 rounded-lg">
                                            <svg className="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                            </svg>
                                        <div className="text-right">
                                                <div className={`text-xs ${isDark ? 'text-slate-400' : 'text-slate-600'}`}>{user.email?.split('@')[0]}</div>
                                            </div>
                                        </div>
                                        <button
                                            onClick={() => {
                                                setShowSavedResumes(!showSavedResumes);
                                                trackEvent('saved_resumes_toggled');
                                            }}
                                            aria-label="View saved resumes"
                                            className={`px-3 py-1.5 text-xs rounded-lg transition-colors ${
                                                isDark 
                                                    ? 'bg-slate-700 text-white hover:bg-slate-600' 
                                                    : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                            }`}
                                            title={`${savedResumes.length} saved`}
                                        >
                                            📁 {savedResumes.length}
                                        </button>
                                        <button
                                            onClick={() => {
                                                setShowStats(true);
                                                trackEvent('stats_modal_opened');
                                            }}
                                            aria-label="View statistics"
                                            className={`px-3 py-1.5 text-xs rounded-lg transition-colors ${
                                                isDark 
                                                    ? 'bg-blue-600 text-white hover:bg-blue-700' 
                                                    : 'bg-blue-500 text-white hover:bg-blue-600'
                                            }`}
                                        >
                                            📊
                                        </button>
                                        <button
                                            onClick={toggleTheme}
                                            aria-label="Toggle theme"
                                            className={`px-3 py-1.5 text-xs rounded-lg transition-colors ${
                                                isDark 
                                                    ? 'bg-slate-700 text-yellow-400 hover:bg-slate-600' 
                                                    : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                            }`}
                                        >
                                            {isDark ? '☀️' : '🌙'}
                                        </button>
                                        <div className={`px-3 py-1.5 rounded-lg ${
                                            isDark ? 'bg-slate-800' : 'bg-slate-50'
                                        }`}>
                                            <div className={`text-xs ${isDark ? 'text-slate-400' : 'text-slate-600'}`}>Credits</div>
                                            <div className={`text-lg font-bold ${isDark ? 'text-white' : 'text-slate-900'}`}>{credits}</div>
                                        </div>
                                        <button
                                            onClick={() => {
                                                trackEvent('pricing_modal_opened');
                                                setShowPricingModal(true);
                                            }}
                                            className={`px-3 py-1.5 text-xs font-semibold rounded-lg transition-colors ${
                                                isDark
                                                    ? 'bg-blue-600 text-white hover:bg-blue-700'
                                                    : 'bg-violet-600 text-white hover:bg-violet-700'
                                            }`}
                                        >
                                            Buy ($1.00)
                                        </button>
                                        <button
                                            onClick={handleSignOut}
                                            className={`px-3 py-1.5 text-xs rounded-lg transition-colors ${
                                                isDark 
                                                    ? 'bg-red-600 text-white hover:bg-red-700' 
                                                    : 'bg-red-500 text-white hover:bg-red-600'
                                            }`}
                                        >
                                            Sign Out
                                        </button>
                                    </>
                                ) : (
                                    <>
                                    <button
                                        onClick={() => {
                                            trackEvent('auth_modal_opened');
                                            setShowAuthModal(true);
                                        }}
                                            className="px-4 py-2 text-sm text-white bg-violet-600 hover:bg-violet-700 rounded-lg transition-colors"
                                    >
                                            Sign In
                                    </button>
                                <button
                                    onClick={() => {
                                        trackEvent('pricing_modal_opened');
                                        setShowPricingModal(true);
                                    }}
                                            className={`px-4 py-2 text-sm font-semibold rounded-lg transition-colors ${
                                                isDark
                                                    ? 'bg-blue-600 text-white hover:bg-blue-700'
                                                    : 'bg-violet-600 text-white hover:bg-violet-700'
                                            }`}
                                        >
                                            Buy Credits ($1.00)
                                </button>
                                    </>
                                )}
                            </div>
                        </div>
                        
                        {/* Usage Limit Display */}
                        {usageLimit && usageLimit.remaining >= 0 && (
                            <div className={`mb-6 p-4 rounded-xl border ${
                                isDark 
                                    ? 'bg-slate-800 border-slate-700' 
                                    : 'bg-slate-100 border-slate-200'
                            }`}>
                                <div className="flex justify-between items-center">
                                    <span className={`text-sm font-medium ${
                                        isDark ? 'text-slate-300' : 'text-slate-700'
                                    }`}>
                                        {usageLimit.remaining === 0 
                                            ? 'No credits available' 
                                            : `Credits Available: ${usageLimit.remaining}`
                                        }
                                    </span>
                                    {usageLimit.remaining === 0 && (
                                        <button
                                            onClick={() => setShowPricingModal(true)}
                                            className={`text-sm font-semibold ${
                                                isDark 
                                                    ? 'text-violet-400 hover:text-violet-300' 
                                                    : 'text-violet-600 hover:text-violet-700'
                                            }`}
                                        >
                                            Buy Credits →
                                        </button>
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {/* Saved Resumes Modal/Section */}
                        {showSavedResumes && (
                            <div className={`mb-6 rounded-2xl border shadow-sm p-8 animate-fade-in ${
                                isDark 
                                    ? 'bg-slate-800 border-slate-700' 
                                    : 'bg-white border-slate-200'
                            }`}>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className={`text-3xl font-bold tracking-tight ${
                                        isDark ? 'text-white' : 'text-slate-900'
                                    }`}>
                                        My Saved Resumes
                                    </h2>
                                    <button
                                        onClick={() => setShowSavedResumes(false)}
                                        className={`px-3 py-1 rounded-lg transition-colors ${
                                            isDark 
                                                ? 'text-slate-400 hover:text-slate-200 hover:bg-slate-700' 
                                                : 'text-slate-600 hover:text-slate-900 hover:bg-slate-100'
                                        }`}
                                    >
                                        ✕
                                    </button>
                                </div>
                                {savedResumes.length === 0 ? (
                                    <p className={`text-center py-12 text-base ${
                                        isDark ? 'text-slate-400' : 'text-slate-500'
                                    }`}>
                                        No saved resumes yet. Generate and save some tailored resumes to see them here!
                                    </p>
                                ) : (
                                    <div className="space-y-4">
                                        {savedResumes.map((savedResume) => (
                                            <div 
                                                key={savedResume.id} 
                                                className={`border rounded-xl p-5 hover:shadow-md transition-all duration-300 ${
                                                    isDark 
                                                        ? 'border-slate-700 bg-slate-700/50 hover:border-slate-600' 
                                                        : 'border-slate-200 bg-slate-50/50 hover:border-slate-300'
                                                }`}
                                            >
                                                <div className="flex justify-between items-start mb-3">
                                                    <div className={`text-xs font-medium ${
                                                        isDark ? 'text-slate-400' : 'text-slate-500'
                                                    }`}>
                                                        {savedResume.sectionType && `${savedResume.sectionType.charAt(0).toUpperCase() + savedResume.sectionType.slice(1)} Section`}
                                                        {savedResume.jobDescription && ` • ${savedResume.jobDescription.substring(0, 30)}...`}
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button
                                                            onClick={() => copyResume(savedResume.tailoredResume)}
                                                            className={`px-3 py-1 text-xs rounded-lg transition-colors ${
                                                                isDark 
                                                                    ? 'bg-slate-600 text-slate-200 hover:bg-slate-500' 
                                                                    : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                                            }`}
                                                        >
                                                            Copy
                                                        </button>
                                                        <button
                                                            onClick={() => deleteResume(savedResume.id)}
                                                            className={`px-3 py-1 text-xs rounded-lg transition-colors ${
                                                                isDark 
                                                                    ? 'bg-red-600 text-white hover:bg-red-700' 
                                                                    : 'bg-red-100 text-red-700 hover:bg-red-200'
                                                            }`}
                                                        >
                                                            Delete
                                                        </button>
                                                    </div>
                                                </div>
                                                <div className={`p-3 rounded-lg ${
                                                    isDark ? 'bg-slate-900' : 'bg-white'
                                                }`}>
                                                    <p className={`text-sm whitespace-pre-wrap ${
                                                        isDark ? 'text-slate-300' : 'text-slate-700'
                                                    }`}>
                                                        {savedResume.tailoredResume}
                                                    </p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                        
                        {/* Input Form */}
                        <div className={`rounded-2xl border shadow-sm p-8 mb-10 hover:shadow-md transition-all duration-300 ${
                            isDark 
                                ? 'bg-slate-800 border-slate-700' 
                                : 'bg-white border-slate-200'
                        }`}>
                            <div className="space-y-6 mb-6">
                                <div>
                                    <label className={`block text-sm font-semibold mb-2.5 tracking-wide ${
                                        isDark ? 'text-slate-300' : 'text-slate-700'
                                    }`}>
                                        Job Description (JD) *
                                    </label>
                                    <textarea
                                        value={jobDescription}
                                        onChange={(e) => setJobDescription(e.target.value)}
                                        placeholder="Paste the full job description here..."
                                        aria-label="Job description input"
                                        aria-required="true"
                                        rows="6"
                                        className={`w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-violet-500 focus:outline-none transition-all duration-200 resize-y ${
                                            isDark 
                                                ? 'border-slate-600 bg-slate-900 text-slate-100 placeholder:text-slate-500 hover:border-slate-500' 
                                                : 'border-slate-300 bg-white text-slate-900 placeholder:text-slate-400 hover:border-slate-400'
                                        }`}
                                    />
                                </div>
                                
                                <div>
                                    <div className="flex justify-between items-center mb-2.5">
                                        <label className={`block text-sm font-semibold tracking-wide ${
                                            isDark ? 'text-slate-300' : 'text-slate-700'
                                        }`}>
                                        Current Resume Section *
                                    </label>
                                        <label className={`cursor-pointer px-3 py-1.5 text-xs rounded-lg transition-colors ${
                                            isDark 
                                                ? 'bg-slate-700 text-white hover:bg-slate-600' 
                                                : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                                        }`}>
                                            <input
                                                type="file"
                                                accept=".pdf,.doc,.docx,.txt"
                                                onChange={handleResumeUpload}
                                                className="hidden"
                                                id="resume-upload"
                                            />
                                            📄 Upload Resume
                                        </label>
                                    </div>
                                    {uploadedFileName && (
                                        <div className={`mb-2 text-xs ${isDark ? 'text-slate-400' : 'text-slate-600'}`}>
                                            Uploaded: {uploadedFileName}
                                        </div>
                                    )}
                                    <div className="mb-2">
                                        <select
                                            value={resumeSectionType}
                                            onChange={(e) => setResumeSectionType(e.target.value)}
                                            aria-label="Resume section type"
                                            className={`px-3 py-2 border rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-violet-500 focus:outline-none text-sm ${
                                                isDark 
                                                    ? 'border-slate-600 bg-slate-900 text-slate-100' 
                                                    : 'border-slate-300 bg-white text-slate-900'
                                            }`}
                                        >
                                            <option value="general">General/Summary</option>
                                            <option value="experience">Experience</option>
                                            <option value="education">Education</option>
                                            <option value="skills">Skills</option>
                                            <option value="summary">Professional Summary</option>
                                        </select>
                                    </div>
                                    <textarea
                                        value={resumeSection}
                                        onChange={(e) => setResumeSection(e.target.value)}
                                        placeholder="Paste your current resume section here or upload a file..."
                                        aria-label="Resume section input"
                                        aria-required="true"
                                        rows="6"
                                        className={`w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-violet-500 focus:outline-none transition-all duration-200 resize-y ${
                                            isDark 
                                                ? 'border-slate-600 bg-slate-900 text-slate-100 placeholder:text-slate-500 hover:border-slate-500' 
                                                : 'border-slate-300 bg-white text-slate-900 placeholder:text-slate-400 hover:border-slate-400'
                                        }`}
                                    />
                                </div>
                            </div>
                            
                            <button
                                onClick={() => {
                                    trackEvent('resume_tailor_clicked', {
                                        sectionType: resumeSectionType
                                    });
                                    generateTailoredResume();
                                }}
                                disabled={loading || !jobDescription.trim() || !resumeSection.trim() || !user}
                                aria-label="Tailor resume to job description"
                                aria-busy={loading}
                                className="w-full bg-gradient-to-r from-violet-600 to-purple-600 text-white py-3.5 px-6 rounded-xl font-semibold hover:from-violet-700 hover:to-purple-700 disabled:from-slate-400 disabled:to-slate-400 disabled:cursor-not-allowed transition-all duration-300 shadow-md hover:shadow-lg hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2"
                            >
                                {loading ? (
                                    <>
                                        <svg className="animate-spin-slow h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                        <span>Tailoring Resume...</span>
                                    </>
                                ) : (
                                    'Tailor Resume'
                                )}
                            </button>
                            
                            {error && (
                                <div className="mt-5 p-4 bg-red-50 border-l-4 border-red-500 text-red-700 rounded-lg animate-fade-in">
                                    <p className="font-medium">{error}</p>
                                </div>
                            )}
                        </div>
                        
                        {/* Tailored Resume Output */}
                        {tailoredResume && (
                            <div className="mb-10 animate-fade-in-up space-y-6">
                                {/* Keyword Match Analysis */}
                                {keywordMatches && (
                                    <div className={`rounded-2xl border shadow-sm p-6 ${
                                        isDark 
                                            ? 'bg-slate-800 border-slate-700' 
                                            : 'bg-white border-slate-200'
                                    }`}>
                                        <h2 className={`text-2xl font-bold mb-4 ${
                                            isDark ? 'text-white' : 'text-slate-900'
                                        }`}>Keyword Match Analysis</h2>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                            <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                                                <div className="text-sm text-blue-600 font-semibold mb-1">Matched Keywords</div>
                                                <div className="text-2xl font-bold text-blue-900">{keywordMatches.matched?.length || 0}</div>
                                            </div>
                                            <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                                                <div className="text-sm text-amber-600 font-semibold mb-1">Missing Keywords</div>
                                                <div className="text-2xl font-bold text-amber-900">{keywordMatches.missing?.length || 0}</div>
                                            </div>
                                            <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                                                <div className="text-sm text-emerald-600 font-semibold mb-1">Match Score</div>
                                                <div className="text-2xl font-bold text-emerald-900">{keywordMatches.matchPercentage || 0}%</div>
                                            </div>
                                        </div>
                                        {keywordMatches.missing && keywordMatches.missing.length > 0 && (
                                            <div className="mt-4">
                                                <div className={`text-sm font-semibold mb-2 ${
                                                    isDark ? 'text-slate-300' : 'text-slate-700'
                                                }`}>Top Missing Keywords:</div>
                                                <div className="flex flex-wrap gap-2">
                                                    {keywordMatches.missing.slice(0, 10).map((keyword, idx) => (
                                                        <span key={idx} className="px-3 py-1 bg-amber-100 text-amber-800 rounded-full text-xs font-medium">
                                                            {keyword}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                                
                                {/* Tailored Resume Section */}
                                <div className={`rounded-2xl border shadow-sm p-6 ${
                                    isDark 
                                        ? 'bg-slate-800 border-slate-700' 
                                        : 'bg-white border-slate-200'
                                }`}>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className={`text-2xl font-bold ${
                                            isDark ? 'text-white' : 'text-slate-900'
                                        }`}>Tailored Resume Section</h2>
                                        <div className="flex gap-2 flex-wrap">
                                            <button
                                                onClick={() => copyResume(tailoredResume)}
                                                className="px-4 py-2 bg-slate-600 text-white rounded-xl text-sm font-semibold hover:bg-slate-700 transition-all"
                                            >
                                                Copy
                                            </button>
                                            {user && (
                                                <button
                                                    onClick={() => saveResume(tailoredResume, jobDescription, resumeSectionType)}
                                                    className="px-4 py-2 bg-violet-600 text-white rounded-xl text-sm font-semibold hover:bg-violet-700 transition-all"
                                                >
                                                    Save
                                                </button>
                                            )}
                                            <button
                                                onClick={() => exportToPDF(tailoredResume)}
                                                className="px-4 py-2 bg-red-600 text-white rounded-xl text-sm font-semibold hover:bg-red-700 transition-all flex items-center gap-1"
                                            >
                                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                                </svg>
                                                Export PDF
                                            </button>
                                            <button
                                                onClick={() => exportToWord(tailoredResume)}
                                                className="px-4 py-2 bg-blue-600 text-white rounded-xl text-sm font-semibold hover:bg-blue-700 transition-all flex items-center gap-1"
                                            >
                                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                                </svg>
                                                Export Word
                                            </button>
                                        </div>
                                    </div>
                                    <div className={`rounded-xl p-6 border ${
                                        isDark 
                                            ? 'bg-slate-900 border-slate-700' 
                                            : 'bg-slate-50 border-slate-200'
                                    }`}>
                                        <p className={`leading-relaxed whitespace-pre-wrap ${
                                            isDark ? 'text-slate-200' : 'text-slate-700'
                                        }`}>{tailoredResume}</p>
                                    </div>
                                </div>
                                
                                {/* Comparison View */}
                                {tailoredResume && resumeSection && (
                                    <div className={`rounded-2xl border shadow-sm p-6 ${
                                    isDark 
                                        ? 'bg-slate-800 border-slate-700' 
                                        : 'bg-white border-slate-200'
                                }`}>
                                        <div className="flex justify-between items-center mb-4">
                                            <h2 className={`text-2xl font-bold ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>Compare Changes</h2>
                                            <button
                                                onClick={() => setShowComparison(!showComparison)}
                                                disabled={loading}
                                                className="px-4 py-2 bg-violet-600 text-white rounded-xl text-sm font-semibold hover:bg-violet-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                                            >
                                                {showComparison ? 'Hide Comparison' : 'Show Comparison'}
                                            </button>
                                        </div>
                                        
                                        {showComparison && (
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                                                {/* Original */}
                                                <div>
                                                    <h3 className={`text-lg font-semibold mb-3 flex items-center gap-2 ${
                                                        isDark ? 'text-slate-300' : 'text-slate-700'
                                                    }`}>
                                                        <span className="w-3 h-3 bg-red-500 rounded-full"></span>
                                                        Original Resume Section
                                                    </h3>
                                                    <div className={`rounded-xl p-4 border-2 ${
                                                        isDark 
                                                            ? 'bg-red-900/30 border-red-800' 
                                                            : 'bg-red-50 border-red-200'
                                                    }`}>
                                                        <p className={`leading-relaxed whitespace-pre-wrap text-sm ${
                                                            isDark ? 'text-slate-300' : 'text-slate-700'
                                                        }`}>{resumeSection}</p>
                                                    </div>
                                                </div>
                                                
                                                {/* Tailored with highlights */}
                                                <div>
                                                    <h3 className="text-lg font-semibold text-slate-700 mb-3 flex items-center gap-2">
                                                        <span className="w-3 h-3 bg-emerald-500 rounded-full"></span>
                                                        Tailored Resume Section
                                                    </h3>
                                                    <div className="bg-emerald-50 rounded-xl p-4 border-2 border-emerald-200">
                                                        <HighlightedText 
                                                            original={resumeSection} 
                                                            tailored={tailoredResume}
                                                            changes={changes}
                                                        />
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                        
                                        {/* Changes Summary */}
                                        {changes && (changes.added?.length > 0 || changes.modified?.length > 0 || changes.improvements?.length > 0) && (
                                            <div className="mt-6 space-y-4">
                                                {changes.added && changes.added.length > 0 && (
                                                    <div className="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                                                        <h4 className="font-semibold text-emerald-800 mb-2 flex items-center gap-2">
                                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                                            </svg>
                                                            Added Keywords/Phrases
                                                        </h4>
                                                        <div className="flex flex-wrap gap-2">
                                                            {changes.added.map((item, idx) => (
                                                                <span key={idx} className="px-3 py-1 bg-emerald-200 text-emerald-900 rounded-full text-xs font-medium">
                                                                    + {item}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                {changes.modified && changes.modified.length > 0 && (
                                                    <div className="bg-amber-50 rounded-xl p-4 border border-amber-200">
                                                        <h4 className="font-semibold text-amber-800 mb-2 flex items-center gap-2">
                                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                            </svg>
                                                            Modified/Improved Sections
                                                        </h4>
                                                        <ul className="space-y-1">
                                                            {changes.modified.map((item, idx) => (
                                                                <li key={idx} className="text-sm text-amber-900">• {item}</li>
                                                            ))}
                                                        </ul>
                                                    </div>
                                                )}
                                                
                                                {changes.improvements && changes.improvements.length > 0 && (
                                                    <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                                                        <h4 className="font-semibold text-blue-800 mb-2 flex items-center gap-2">
                                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                            </svg>
                                                            Key Improvements Made
                                                        </h4>
                                                        <ul className="space-y-1">
                                                            {changes.improvements.map((item, idx) => (
                                                                <li key={idx} className="text-sm text-blue-900">✓ {item}</li>
                                                            ))}
                                                        </ul>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                )}
                                
                                {/* Improvement Tips */}
                                <div className={`rounded-2xl border shadow-sm p-6 ${
                                    isDark 
                                        ? 'bg-slate-800 border-slate-700' 
                                        : 'bg-white border-slate-200'
                                }`}>
                                    <h2 className="text-2xl font-bold text-slate-900 mb-4">💡 Improvement Tips & Recommendations</h2>
                                    {improvementTips && improvementTips.length > 0 ? (
                                        <div className="space-y-3">
                                            {improvementTips.map((tip, idx) => (
                                                <div 
                                                    key={idx}
                                                    className={`p-4 rounded-xl border-l-4 ${
                                                        tip.priority === 'high' ? 'bg-red-50 border-red-400' :
                                                        tip.priority === 'medium' ? 'bg-amber-50 border-amber-400' :
                                                        'bg-blue-50 border-blue-400'
                                                    }`}
                                                >
                                                    <div className="flex items-start gap-2">
                                                        <span className={`text-xs font-bold px-2 py-1 rounded ${
                                                            tip.category === 'ats' ? 'bg-red-200 text-red-800' :
                                                            tip.category === 'achievements' ? 'bg-blue-200 text-blue-800' :
                                                            tip.category === 'skills' ? 'bg-purple-200 text-purple-800' :
                                                            'bg-slate-200 text-slate-800'
                                                        }`}>
                                                            {tip.category?.toUpperCase() || 'TIP'}
                                                        </span>
                                                        <div className="flex-1">
                                                            <p className="text-slate-700">{tip.tip}</p>
                                                            {tip.priority && (
                                                                <span className={`text-xs mt-1 inline-block px-2 py-0.5 rounded ${
                                                                    tip.priority === 'high' ? 'bg-red-200 text-red-800' :
                                                                    tip.priority === 'medium' ? 'bg-amber-200 text-amber-800' :
                                                                    'bg-blue-200 text-blue-800'
                                                                }`}>
                                                                        {tip.priority} priority
                                                                    </span>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                                            <p className="text-slate-600 text-sm">
                                                Generating improvement tips... If none appear, try tailoring again or check that the job description contains specific requirements.
                                            </p>
                                    </div>
                                )}
                                </div>
                            </div>
                        )}
                        
                        {/* Saved Resumes */}
                        <div className={`rounded-2xl border shadow-sm p-8 animate-fade-in-up ${
                            isDark 
                                ? 'bg-slate-800 border-slate-700' 
                                : 'bg-white border-slate-200'
                        }`}>
                            <h2 className={`text-3xl font-bold mb-6 tracking-tight ${
                                isDark ? 'text-white' : 'text-slate-900'
                            }`}>My Saved Resumes</h2>
                            {!firebaseReady && (
                                <p className="text-slate-500 text-sm mb-4 p-4 bg-slate-50 rounded-xl border border-slate-200">
                                    Firebase not configured. Saved resumes will appear here once configured.
                                </p>
                            )}
                            {savedResumes.length === 0 && firebaseReady && (
                                <p className="text-slate-500 text-center py-12 text-base">
                                    No saved resumes yet. Generate and save some tailored resumes to see them here!
                                </p>
                            )}
                            {savedResumes.length > 0 && (
                                <div className="space-y-4">
                                    {savedResumes.map((savedResume) => (
                                        <div 
                                            key={savedResume.id} 
                                            className="border border-slate-200 rounded-xl p-5 hover:shadow-md hover:border-slate-300 transition-all duration-300 animate-fade-in bg-slate-50/50"
                                        >
                                            <div className="flex justify-between items-start mb-3">
                                                <div className="text-xs text-slate-500 font-medium">
                                                    {savedResume.sectionType && `${savedResume.sectionType.charAt(0).toUpperCase() + savedResume.sectionType.slice(1)} Section`}
                                                    {savedResume.jobDescription && ` • ${savedResume.jobDescription.substring(0, 30)}...`}
                                                </div>
                                                <button
                                                    onClick={() => deleteResume(savedResume.id)}
                                                    className="text-red-500 hover:text-red-700 text-sm font-semibold hover:scale-110 transition-transform duration-200 px-2 py-1 rounded-lg hover:bg-red-50"
                                                >
                                                    Delete
                                                </button>
                                            </div>
                                            <p className="text-slate-700 mb-4 leading-relaxed text-[15px]">
                                                {savedResume.resume}
                                            </p>
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={() => copyResume(savedResume.resume)}
                                                    className="bg-slate-600 text-white py-2 px-5 rounded-xl text-sm font-semibold hover:bg-slate-700 transition-all duration-200 hover:scale-105 active:scale-95 shadow-sm hover:shadow-md"
                                                >
                                                    Copy
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                        </div>
                    )}
                    
                    {/* Authentication Modal */}
                    {showAuthModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className={`rounded-2xl shadow-xl max-w-md w-full p-8 animate-fade-in ${
                                isDark 
                                    ? 'bg-slate-800 border border-slate-700' 
                                    : 'bg-white'
                            }`}>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-slate-900">
                                        {authMode === 'signin' ? 'Sign In' : 'Sign Up'}
                                    </h2>
                                    <button
                                        onClick={() => {
                                            // Only allow closing if user is authenticated
                                            if (user) {
                                                setShowAuthModal(false);
                                                setError('');
                                                setEmail('');
                                                setPassword('');
                                            }
                                        }}
                                        className={`text-slate-400 hover:text-slate-600 ${!user ? 'opacity-50 cursor-not-allowed' : ''}`}
                                        disabled={!user}
                                        title={!user ? 'Please sign in to continue' : 'Close'}
                                    >
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-semibold text-slate-700 mb-2">
                                            Email
                                        </label>
                                        <input
                                            type="email"
                                            value={email}
                                            onChange={(e) => setEmail(e.target.value)}
                                            placeholder="your@email.com"
                                            className="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-violet-500 focus:outline-none text-slate-900 bg-white"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-semibold text-slate-700 mb-2">
                                            Password
                                        </label>
                                        <input
                                            type="password"
                                            value={password}
                                            onChange={(e) => setPassword(e.target.value)}
                                            placeholder="••••••••"
                                            className="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-violet-500 focus:outline-none text-slate-900 bg-white"
                                        />
                                    </div>
                                    
                                    {error && (
                                        <div className="p-3 bg-red-50 border border-red-200 text-red-700 rounded-xl text-sm">
                                            {error}
                                        </div>
                                    )}
                                    
                                    <button
                                        onClick={authMode === 'signin' ? handleSignIn : handleSignUp}
                                        disabled={authLoading}
                                        className="w-full bg-gradient-to-r from-violet-600 to-purple-600 text-white py-3.5 px-6 rounded-xl font-semibold hover:from-violet-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300"
                                    >
                                        {authLoading ? 'Loading...' : (authMode === 'signin' ? 'Sign In' : 'Sign Up')}
                                    </button>
                                    
                                    <div className="text-center text-sm text-slate-600">
                                        {authMode === 'signin' ? (
                                            <>
                                                Don't have an account?{' '}
                                                <button
                                                    onClick={() => {
                                                        setAuthMode('signup');
                                                        setError('');
                                                    }}
                                                    className="text-violet-600 hover:text-violet-700 font-semibold"
                                                >
                                                    Sign Up
                                                </button>
                                            </>
                                        ) : (
                                            <>
                                                Already have an account?{' '}
                                                <button
                                                    onClick={() => {
                                                        setAuthMode('signin');
                                                        setError('');
                                                    }}
                                                    className="text-violet-600 hover:text-violet-700 font-semibold"
                                                >
                                                    Sign In
                                                </button>
                                            </>
                                        )}
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Pricing Modal */}
                    {showPricingModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className={`rounded-2xl shadow-xl max-w-2xl w-full p-8 animate-fade-in max-h-[90vh] overflow-y-auto ${
                                isDark 
                                    ? 'bg-slate-800 border border-slate-700' 
                                    : 'bg-white'
                            }`}>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className={`text-3xl font-bold ${
                                        isDark ? 'text-white' : 'text-slate-900'
                                    }`}>
                                        Purchase Credits
                                    </h2>
                                    <button
                                        onClick={() => setShowPricingModal(false)}
                                        className={isDark ? 'text-slate-300 hover:text-white' : 'text-slate-400 hover:text-slate-600'}
                                    >
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <div className="space-y-6">
                                    <div className={`rounded-xl p-6 border-2 ${
                                        isDark 
                                            ? 'bg-gradient-to-r from-slate-700 to-slate-800 border-slate-600' 
                                            : 'bg-gradient-to-r from-violet-50 to-purple-50 border-violet-200'
                                    }`}>
                                        <div className="text-center mb-4">
                                            <div className={`text-4xl font-bold mb-2 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>$1.00</div>
                                            <div className={isDark ? 'text-slate-300' : 'text-slate-600'}>for 5 credits</div>
                                        </div>
                                        
                                        <ul className="space-y-3 mb-6">
                                            <li className="flex items-start gap-3">
                                                <svg className="w-5 h-5 text-emerald-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                </svg>
                                                <span className={isDark ? 'text-slate-300' : 'text-slate-700'}>AI-powered resume tailoring with keyword matching</span>
                                            </li>
                                            <li className="flex items-start gap-3">
                                                <svg className="w-5 h-5 text-emerald-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                </svg>
                                                <span className={isDark ? 'text-slate-200' : 'text-slate-700'}>Unlock premium features after first purchase (advanced tailoring, export options)</span>
                                            </li>
                                            <li className="flex items-start gap-3">
                                                <svg className="w-5 h-5 text-emerald-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                </svg>
                                                <span className={isDark ? 'text-slate-200' : 'text-slate-700'}>Keyword analysis and improvement tips for ATS optimization</span>
                                            </li>
                                            <li className="flex items-start gap-3">
                                                <svg className="w-5 h-5 text-emerald-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                </svg>
                                                <span className={isDark ? 'text-slate-200' : 'text-slate-700'}>Export to PDF and Word documents</span>
                                            </li>
                                            <li className="flex items-start gap-3">
                                                <svg className="w-5 h-5 text-emerald-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                </svg>
                                                <span className={isDark ? 'text-slate-200' : 'text-slate-700'}>Create custom tones</span>
                                            </li>
                                            <li className="flex items-start gap-3">
                                                <svg className="w-5 h-5 text-emerald-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                </svg>
                                                <span className={isDark ? 'text-slate-200' : 'text-slate-700'}>Priority processing</span>
                                            </li>
                                        </ul>
                                        
                                        {!user ? (
                                            <div className="space-y-3">
                                                <button
                                                    onClick={() => {
                                                        setShowPricingModal(false);
                                                        setShowAuthModal(true);
                                                        setAuthMode('signup');
                                                    }}
                                                    className="w-full bg-gradient-to-r from-violet-600 to-purple-600 text-white py-3.5 px-6 rounded-xl font-semibold hover:from-violet-700 hover:to-purple-700 transition-all duration-300"
                                                >
                                                    Sign Up & Start 1-Day Free Trial
                                                </button>
                                                <p className={`text-center text-sm ${
                                                    isDark ? 'text-slate-300' : 'text-slate-600'
                                                }`}>
                                                    Already have an account?{' '}
                                                    <button
                                                        onClick={() => {
                                                            setShowPricingModal(false);
                                                            setShowAuthModal(true);
                                                            setAuthMode('signin');
                                                        }}
                                                        className="text-violet-600 hover:text-violet-700 font-semibold"
                                                    >
                                                        Sign In
                                                    </button>
                                                </p>
                                            </div>
                                        ) : hasPaidOnce ? (
                                            <div className="text-center">
                                                <p className={`mb-4 ${
                                                    isDark ? 'text-slate-200' : 'text-slate-600'
                                                }`}>You have premium features unlocked!</p>
                                                <p className={`text-sm ${
                                                    isDark ? 'text-slate-300' : 'text-slate-500'
                                                }`}>
                                                    Purchase more credits to continue using the service.
                                                </p>
                                            </div>
                                        ) : (
                                            <button
                                                onClick={handleStripeCheckout}
                                                disabled={checkoutLoading}
                                                aria-label="Buy generation"
                                                aria-busy={checkoutLoading}
                                                className="w-full bg-gradient-to-r from-violet-600 to-purple-600 text-white py-3.5 px-6 rounded-xl font-semibold hover:from-violet-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2"
                                            >
                                                {checkoutLoading ? (
                                                    <>
                                                        <svg className="animate-spin-slow h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                        </svg>
                                                        <span>Processing...</span>
                                                    </>
                                                ) : (
                                                    'Buy 5 Credits - $1.00'
                                                )}
                                            </button>
                                        )}
                                    </div>
                                    
                                    {!hasPaidOnce && user && (
                                        <div className="p-4 bg-emerald-50 border border-emerald-200 rounded-xl text-sm text-emerald-700">
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Statistics Modal */}
                    {showStats && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className={`rounded-2xl shadow-xl max-w-2xl w-full p-8 animate-fade-in max-h-[90vh] overflow-y-auto ${
                                isDark 
                                    ? 'bg-slate-800 border border-slate-700' 
                                    : 'bg-white'
                            }`}>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-3xl font-bold text-slate-900">
                                        Usage Statistics
                                    </h2>
                                    <button
                                        onClick={() => setShowStats(false)}
                                        aria-label="Close statistics"
                                        className="text-slate-400 hover:text-slate-600 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 rounded-lg"
                                    >
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                
                                {statsLoading ? (
                                    <div className="flex items-center justify-center py-12">
                                        <div className="animate-spin-slow h-8 w-8 border-4 border-violet-200 border-t-violet-600 rounded-full"></div>
                                    </div>
                                ) : userStats ? (
                                    <div className="space-y-6">
                                        {/* Stats Grid */}
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div className="bg-gradient-to-br from-violet-50 to-purple-50 rounded-xl p-6 border border-violet-200">
                                                <div className="text-sm text-violet-600 font-semibold mb-2">Total Generations</div>
                                                <div className="text-4xl font-bold text-slate-900">{userStats.totalGenerations}</div>
                                                <div className="text-xs text-slate-500 mt-1">Resumes tailored</div>
                                            </div>
                                            
                                            <div className="bg-gradient-to-br from-emerald-50 to-green-50 rounded-xl p-6 border border-emerald-200">
                                                <div className="text-sm text-emerald-600 font-semibold mb-2">Saved Resumes</div>
                                                <div className="text-4xl font-bold text-slate-900">{userStats.savedResumes}</div>
                                                <div className="text-xs text-slate-500 mt-1">In your favorites</div>
                                            </div>
                                            
                                            <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-200">
                                                <div className="text-sm text-blue-600 font-semibold mb-2">Credits Used</div>
                                                <div className="text-4xl font-bold text-slate-900">{Math.max(0, userStats.creditsUsed)}</div>
                                                <div className="text-xs text-slate-500 mt-1">Paid generations</div>
                                            </div>
                                            
                                            <div className="bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-6 border border-amber-200">
                                                <div className="text-sm text-amber-600 font-semibold mb-2">Credits Remaining</div>
                                                <div className="text-4xl font-bold text-slate-900">{userStats.creditsRemaining}</div>
                                                <div className="text-xs text-slate-500 mt-1">Available now</div>
                                            </div>
                                        </div>
                                        
                                        {/* Account Info */}
                                        <div className="bg-slate-50 rounded-xl p-6 border border-slate-200">
                                            <h3 className="text-lg font-semibold text-slate-900 mb-4">Account Information</h3>
                                            <div className="space-y-3">
                                                <div className="flex justify-between items-center">
                                                    <span className="text-sm text-slate-600">Account Status</span>
                                                    <span className="text-sm font-semibold text-slate-900">
                                                        {userStats.hasPaidOnce ? (
                                                            <span className="text-violet-600">Premium</span>
                                                        ) : (
                                                            <span className="text-slate-600">Free</span>
                                                        )}
                                                    </span>
                                                </div>
                                                <div className="flex justify-between items-center">
                                                    <span className="text-sm text-slate-600">Account Created</span>
                                                    <span className="text-sm font-semibold text-slate-900">{userStats.accountCreated}</span>
                                                </div>
                                                <div className="flex justify-between items-center">
                                                    <span className="text-sm text-slate-600">Last Generation</span>
                                                    <span className="text-sm font-semibold text-slate-900">{userStats.lastGeneration}</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        {/* Tips */}
                                        {userStats.totalGenerations > 0 && (
                                            <div className="bg-violet-50 rounded-xl p-6 border border-violet-200">
                                                <h3 className="text-lg font-semibold text-violet-900 mb-3">💡 Tips</h3>
                                                <ul className="space-y-2 text-sm text-violet-700">
                                                    {userStats.savedResumes === 0 && (
                                                        <li>• Save your favorite tailored resumes for easy access later</li>
                                                    )}
                                                    {userStats.totalGenerations < 3 && (
                                                        <li>• Try tailoring different resume sections to see which works best for you</li>
                                                    )}
                                                    {!userStats.hasPaidOnce && userStats.creditsRemaining === 0 && (
                                                        <li>• Upgrade to premium to unlock advanced tailoring features and export options</li>
                                                    )}
                                                    {userStats.totalGenerations >= 5 && (
                                                        <li>• You're getting the hang of it! Experiment with different job descriptions for better results</li>
                                                    )}
                                                </ul>
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    <div className="text-center py-12 text-slate-500">
                                        No statistics available
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                    
                    {/* Authentication Modal */}
                    {showAuthModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className={`rounded-2xl shadow-xl max-w-md w-full p-8 animate-fade-in ${
                                isDark 
                                    ? 'bg-slate-800 border border-slate-700' 
                                    : 'bg-white'
                            }`}>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className={`text-2xl font-bold ${
                                        isDark ? 'text-white' : 'text-slate-900'
                                    }`}>
                                        {authMode === 'signin' ? 'Sign In' : 'Sign Up'}
                                    </h2>
                                    <button
                                        onClick={() => {
                                            if (user) {
                                                setShowAuthModal(false);
                                                setError('');
                                                setEmail('');
                                                setPassword('');
                                            }
                                        }}
                                        className={isDark ? 'text-slate-300 hover:text-white' : 'text-slate-400 hover:text-slate-600'}
                                    >
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <div className="space-y-4">
                                    <div>
                                        <label className={`block text-sm font-semibold mb-2 ${
                                            isDark ? 'text-slate-300' : 'text-slate-700'
                                        }`}>
                                            Email
                                        </label>
                                        <input
                                            type="email"
                                            value={email}
                                            onChange={(e) => setEmail(e.target.value)}
                                            placeholder="your@email.com"
                                            className={`w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-violet-500 focus:outline-none ${
                                                isDark 
                                                    ? 'border-slate-600 bg-slate-900 text-slate-100' 
                                                    : 'border-slate-300 bg-white text-slate-900'
                                            }`}
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className={`block text-sm font-semibold mb-2 ${
                                            isDark ? 'text-slate-300' : 'text-slate-700'
                                        }`}>
                                            Password
                                        </label>
                                        <input
                                            type="password"
                                            value={password}
                                            onChange={(e) => setPassword(e.target.value)}
                                            placeholder="••••••••"
                                            className={`w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-violet-500 focus:outline-none ${
                                                isDark 
                                                    ? 'border-slate-600 bg-slate-900 text-slate-100' 
                                                    : 'border-slate-300 bg-white text-slate-900'
                                            }`}
                                        />
                                    </div>
                                    
                                    {error && (
                                        <div className="p-3 bg-red-50 border border-red-200 text-red-700 rounded-xl text-sm">
                                            {error}
                                        </div>
                                    )}
                                    
                                    <button
                                        onClick={authMode === 'signin' ? handleSignIn : handleSignUp}
                                        disabled={authLoading}
                                        className="w-full bg-gradient-to-r from-violet-600 to-purple-600 text-white py-3.5 px-6 rounded-xl font-semibold hover:from-violet-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300"
                                    >
                                        {authLoading ? 'Loading...' : (authMode === 'signin' ? 'Sign In' : 'Sign Up')}
                                    </button>
                                    
                                    <div className={`text-center text-sm ${
                                        isDark ? 'text-slate-300' : 'text-slate-600'
                                    }`}>
                                        {authMode === 'signin' ? (
                                            <>
                                                Don't have an account?{' '}
                                                <button
                                                    onClick={() => {
                                                        setAuthMode('signup');
                                                        setError('');
                                                    }}
                                                    className="text-violet-600 hover:text-violet-700 font-semibold"
                                                >
                                                    Sign Up
                                                </button>
                                            </>
                                        ) : (
                                            <>
                                                Already have an account?{' '}
                                                <button
                                                    onClick={() => {
                                                        setAuthMode('signin');
                                                        setError('');
                                                    }}
                                                    className="text-violet-600 hover:text-violet-700 font-semibold"
                                                >
                                                    Sign In
                                                </button>
                                            </>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Pricing Modal */}
                    {showPricingModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className={`rounded-2xl shadow-xl max-w-2xl w-full p-8 animate-fade-in max-h-[90vh] overflow-y-auto ${
                                isDark 
                                    ? 'bg-slate-800 border border-slate-700' 
                                    : 'bg-white'
                            }`}>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className={`text-3xl font-bold ${
                                        isDark ? 'text-white' : 'text-slate-900'
                                    }`}>
                                        Purchase Credits
                                    </h2>
                                    <button
                                        onClick={() => setShowPricingModal(false)}
                                        className={isDark ? 'text-slate-300 hover:text-white' : 'text-slate-400 hover:text-slate-600'}
                                    >
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <div className="space-y-6">
                                    <div className={`rounded-xl p-6 border-2 ${
                                        isDark 
                                            ? 'bg-gradient-to-r from-slate-700 to-slate-800 border-slate-600' 
                                            : 'bg-gradient-to-r from-violet-50 to-purple-50 border-violet-200'
                                    }`}>
                                        <div className="text-center mb-4">
                                            <div className={`text-4xl font-bold mb-2 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>$1.00</div>
                                            <div className={isDark ? 'text-slate-300' : 'text-slate-600'}>for 5 credits</div>
                                        </div>
                                        
                                        <ul className="space-y-3 mb-6">
                                            <li className="flex items-start gap-3">
                                                <svg className="w-5 h-5 text-emerald-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                </svg>
                                                <span className={isDark ? 'text-slate-300' : 'text-slate-700'}>AI-powered resume tailoring with keyword matching</span>
                                            </li>
                                            <li className="flex items-start gap-3">
                                                <svg className="w-5 h-5 text-emerald-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                </svg>
                                                <span className={isDark ? 'text-slate-200' : 'text-slate-700'}>Unlock premium features after first purchase (advanced tailoring, export options)</span>
                                            </li>
                                            <li className="flex items-start gap-3">
                                                <svg className="w-5 h-5 text-emerald-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                </svg>
                                                <span className={isDark ? 'text-slate-200' : 'text-slate-700'}>Keyword analysis and improvement tips for ATS optimization</span>
                                            </li>
                                            <li className="flex items-start gap-3">
                                                <svg className="w-5 h-5 text-emerald-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                </svg>
                                                <span className={isDark ? 'text-slate-200' : 'text-slate-700'}>Export to PDF and Word documents</span>
                                            </li>
                                            <li className="flex items-start gap-3">
                                                <svg className="w-5 h-5 text-emerald-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                </svg>
                                                <span className={isDark ? 'text-slate-200' : 'text-slate-700'}>Create custom tones</span>
                                            </li>
                                            <li className="flex items-start gap-3">
                                                <svg className="w-5 h-5 text-emerald-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                </svg>
                                                <span className={isDark ? 'text-slate-200' : 'text-slate-700'}>Priority processing</span>
                                            </li>
                                        </ul>
                                        
                                        {!user ? (
                                            <div className="space-y-3">
                                                <button
                                                    onClick={() => {
                                                        setShowPricingModal(false);
                                                        setShowAuthModal(true);
                                                        setAuthMode('signup');
                                                    }}
                                                    className="w-full bg-gradient-to-r from-violet-600 to-purple-600 text-white py-3.5 px-6 rounded-xl font-semibold hover:from-violet-700 hover:to-purple-700 transition-all duration-300"
                                                >
                                                    Sign Up & Start 1-Day Free Trial
                                                </button>
                                                <p className={`text-center text-sm ${
                                                    isDark ? 'text-slate-300' : 'text-slate-600'
                                                }`}>
                                                    Already have an account?{' '}
                                                    <button
                                                        onClick={() => {
                                                            setShowPricingModal(false);
                                                            setShowAuthModal(true);
                                                            setAuthMode('signin');
                                                        }}
                                                        className="text-violet-600 hover:text-violet-700 font-semibold"
                                                    >
                                                        Sign In
                                                    </button>
                                                </p>
                                            </div>
                                        ) : hasPaidOnce ? (
                                            <div className="text-center">
                                                <p className={`mb-4 ${
                                                    isDark ? 'text-slate-200' : 'text-slate-600'
                                                }`}>You have premium features unlocked!</p>
                                                <p className={`text-sm ${
                                                    isDark ? 'text-slate-300' : 'text-slate-500'
                                                }`}>
                                                    Purchase more credits to continue using the service.
                                                </p>
                                            </div>
                                        ) : (
                                            <button
                                                onClick={handleStripeCheckout}
                                                disabled={checkoutLoading}
                                                aria-label="Buy credits"
                                                className="w-full bg-gradient-to-r from-violet-600 to-purple-600 text-white py-3.5 px-6 rounded-xl font-semibold hover:from-violet-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2"
                                            >
                                                {checkoutLoading ? (
                                                    <>
                                                        <svg className="animate-spin-slow h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                        </svg>
                                                        <span>Processing...</span>
                                                    </>
                                                ) : (
                                                    'Buy 5 Credits - $1.00'
                                                )}
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Statistics Modal */}
                    {showStats && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className={`rounded-2xl shadow-xl max-w-2xl w-full p-8 animate-fade-in max-h-[90vh] overflow-y-auto ${
                                isDark 
                                    ? 'bg-slate-800 border border-slate-700' 
                                    : 'bg-white'
                            }`}>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className={`text-3xl font-bold ${
                                        isDark ? 'text-white' : 'text-slate-900'
                                    }`}>
                                        Usage Statistics
                                    </h2>
                                    <button
                                        onClick={() => setShowStats(false)}
                                        className={isDark ? 'text-slate-300 hover:text-white' : 'text-slate-400 hover:text-slate-600'}
                                    >
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                
                                {statsLoading ? (
                                    <div className="flex items-center justify-center py-12">
                                        <div className="animate-spin-slow h-8 w-8 border-4 border-violet-200 border-t-violet-600 rounded-full"></div>
                                    </div>
                                ) : userStats ? (
                                    <div className="space-y-6">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div className={`rounded-xl p-6 border ${
                                                isDark ? 'bg-slate-700 border-slate-600' : 'bg-gradient-to-br from-violet-50 to-purple-50 border-violet-200'
                                            }`}>
                                                <div className={`text-sm font-semibold mb-2 ${
                                                    isDark ? 'text-violet-400' : 'text-violet-600'
                                                }`}>Total Generations</div>
                                                <div className={`text-4xl font-bold ${
                                                    isDark ? 'text-white' : 'text-slate-900'
                                                }`}>{userStats.totalGenerations}</div>
                                                <div className={`text-xs mt-1 ${
                                                    isDark ? 'text-slate-400' : 'text-slate-500'
                                                }`}>Resumes tailored</div>
                                            </div>
                                            
                                            <div className={`rounded-xl p-6 border ${
                                                isDark ? 'bg-slate-700 border-slate-600' : 'bg-gradient-to-br from-emerald-50 to-green-50 border-emerald-200'
                                            }`}>
                                                <div className={`text-sm font-semibold mb-2 ${
                                                    isDark ? 'text-emerald-400' : 'text-emerald-600'
                                                }`}>Saved Resumes</div>
                                                <div className={`text-4xl font-bold ${
                                                    isDark ? 'text-white' : 'text-slate-900'
                                                }`}>{userStats.savedResumes}</div>
                                                <div className={`text-xs mt-1 ${
                                                    isDark ? 'text-slate-400' : 'text-slate-500'
                                                }`}>In your favorites</div>
                                            </div>
                                            
                                            <div className={`rounded-xl p-6 border ${
                                                isDark ? 'bg-slate-700 border-slate-600' : 'bg-gradient-to-br from-blue-50 to-cyan-50 border-blue-200'
                                            }`}>
                                                <div className={`text-sm font-semibold mb-2 ${
                                                    isDark ? 'text-blue-400' : 'text-blue-600'
                                                }`}>Credits Used</div>
                                                <div className={`text-4xl font-bold ${
                                                    isDark ? 'text-white' : 'text-slate-900'
                                                }`}>{Math.max(0, userStats.creditsUsed)}</div>
                                                <div className={`text-xs mt-1 ${
                                                    isDark ? 'text-slate-400' : 'text-slate-500'
                                                }`}>Paid generations</div>
                                            </div>
                                            
                                            <div className={`rounded-xl p-6 border ${
                                                isDark ? 'bg-slate-700 border-slate-600' : 'bg-gradient-to-br from-amber-50 to-orange-50 border-amber-200'
                                            }`}>
                                                <div className={`text-sm font-semibold mb-2 ${
                                                    isDark ? 'text-amber-400' : 'text-amber-600'
                                                }`}>Credits Remaining</div>
                                                <div className={`text-4xl font-bold ${
                                                    isDark ? 'text-white' : 'text-slate-900'
                                                }`}>{userStats.creditsRemaining}</div>
                                                <div className={`text-xs mt-1 ${
                                                    isDark ? 'text-slate-400' : 'text-slate-500'
                                                }`}>Available now</div>
                                            </div>
                                        </div>
                                        
                                        <div className={`rounded-xl p-6 border ${
                                            isDark ? 'bg-slate-700 border-slate-600' : 'bg-slate-50 border-slate-200'
                                        }`}>
                                            <h3 className={`text-lg font-semibold mb-4 ${
                                                isDark ? 'text-white' : 'text-slate-900'
                                            }`}>Account Information</h3>
                                            <div className="space-y-3">
                                                <div className="flex justify-between items-center">
                                                    <span className={isDark ? 'text-slate-300' : 'text-slate-600'}>Account Created</span>
                                                    <span className={`font-semibold ${
                                                        isDark ? 'text-white' : 'text-slate-900'
                                                    }`}>{userStats.accountCreated}</span>
                                                </div>
                                                <div className="flex justify-between items-center">
                                                    <span className={isDark ? 'text-slate-300' : 'text-slate-600'}>Last Generation</span>
                                                    <span className={`font-semibold ${
                                                        isDark ? 'text-white' : 'text-slate-900'
                                                    }`}>{userStats.lastGeneration}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className={`text-center py-12 ${
                                        isDark ? 'text-slate-400' : 'text-slate-500'
                                    }`}>
                                        No statistics available
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        
        // Error suppression for old cached code (temporary)
        // These errors are from old cached JavaScript that will be cleared on next hard refresh
        const originalError = console.error;
        console.error = function(...args) {
            const message = args.join(' ');
            // Suppress errors from old cached code that no longer exists
            if (message.includes('loadUserStats') || 
                message.includes('listening to credits') || 
                message.includes('auto-saving resume text') ||
                (message.includes('Invalid document reference') && message.includes('/stats')) ||
                message.includes('Error loading stats') ||
                message.includes('Error listening to credits') ||
                message.includes('Error auto-saving')) {
                // These are from old cached code, ignore them
                // User should do a hard refresh (Cmd+Shift+R) to clear cache
                return;
            }
            originalError.apply(console, args);
        };
        
        // Force clear service worker cache on load to remove old cached code
        // Only do this once per session to avoid infinite loops
        const cacheCleared = sessionStorage.getItem('resumeforge_cache_cleared');
        if (!cacheCleared && 'serviceWorker' in navigator) {
            sessionStorage.setItem('resumeforge_cache_cleared', 'true');
            navigator.serviceWorker.getRegistrations().then(registrations => {
                if (registrations.length > 0) {
                    registrations.forEach(registration => {
                        // Unregister old service workers to clear cache
                        registration.unregister().then(() => {
                            console.log('Old Service Worker unregistered to clear cache');
                            // Clear all caches aggressively
                            if ('caches' in window) {
                                caches.keys().then(cacheNames => {
                                    return Promise.all(
                                        cacheNames.map(cacheName => {
                                            console.log('Deleting cache:', cacheName);
                                            return caches.delete(cacheName);
                                        })
                                    );
                                }).then(() => {
                                    console.log('All caches cleared. Reloading page to get fresh code...');
                                    // Force reload to get fresh code (only once)
                                    setTimeout(() => {
                                        window.location.reload(true);
                                    }, 500);
                                });
                            }
                        });
                    });
                }
            });
        }
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

